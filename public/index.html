<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeraphBlox - Roblox Script Sharing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Firebase SDK -->
  <!--  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script> -->
   <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script> -->
   <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script> -->
   <!-- <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script> -->
    
<script defer src="/__/firebase/12.4.0/firebase-app-compat.js"></script>
<script defer src="/__/firebase/12.4.0/firebase-auth-compat.js"></script>
<script defer src="/__/firebase/12.4.0/firebase-database-compat.js"></script>
<script defer src="/__/firebase/12.4.0/firebase-firestore-compat.js"></script>
<script defer src="/__/firebase/init.js?useEmulator=true"></script>

    
   <!-- Highlight.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/lua.min.js"></script>

<style>
:root {
    /* Core Palette */
    --primary: #8b5cf6;
    --primary-dark: #7c3aed;
    --secondary: #06d6a0;
    --dark: #0f0f23;
    --darker: #090915;
    --light: #e2e8f0;
    --gray: #64748b;
    --danger: #ef4444;
    --success: #10b981;
    --warning: #f59e0b;

    /* Card + Background */
    --card-bg: #1a1a2e;
    --card-hover: #252544;

    /* Base Colors */
    --bg-primary: var(--dark);
    --bg-secondary: var(--darker);
    --bg-card: var(--card-bg);
    --bg-card-hover: var(--card-hover);
    --text-primary: var(--light);
    --text-secondary: var(--gray);
    --text-muted: #94a3b8;
    --border-primary: rgba(139, 92, 246, 0.3);
    --border-secondary: rgba(139, 92, 246, 0.1);
}

/* üåû Light Theme */
[data-theme="light"] {
    --bg-primary: #f9fafb;
    --bg-secondary: #ffffff;
    --bg-card: #ffffff;
    --bg-card-hover: #f1f5f9;
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --border-primary: rgba(139, 92, 246, 0.2);
    --border-secondary: rgba(139, 92, 246, 0.1);
    --dark: #f8fafc;
    --darker: #ffffff;
    --light: #1e293b;
    --gray: #64748b;
    --card-bg: #ffffff;
    --card-hover: #f8fafc;
}

/* üåö Dark Theme */
[data-theme="dark"] {
    --bg-primary: #0f0f23;
    --bg-secondary: #090915;
    --bg-card: #1a1a2e;
    --bg-card-hover: #252544;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    --border-primary: rgba(139, 92, 246, 0.3);
    --border-secondary: rgba(139, 92, 246, 0.1);
}

/* üíô Blue Theme */
[data-theme="blue"] {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-card: #1e293b;
    --bg-card-hover: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --primary: #3b82f6;
    --primary-dark: #2563eb;
    --border-primary: rgba(59, 130, 246, 0.3);
}

/* üíö Green Theme */
[data-theme="green"] {
    --bg-primary: #052e16;
    --bg-secondary: #064e3b;
    --bg-card: #14532d;
    --bg-card-hover: #166534;
    --text-primary: #ecfdf5;
    --text-secondary: #bbf7d0;
    --text-muted: #86efac;
    --primary: #10b981;
    --primary-dark: #059669;
    --border-primary: rgba(16, 185, 129, 0.3);
}

/* üíú Purple Theme */
[data-theme="purple"] {
    --bg-primary: #1e1b4b;
    --bg-secondary: #312e81;
    --bg-card: #312e81;
    --bg-card-hover: #4338ca;
    --text-primary: #fafafa;
    --text-secondary: #ddd6fe;
    --text-muted: #c4b5fd;
    --primary: #8b5cf6;
    --primary-dark: #7c3aed;
    --border-primary: rgba(139, 92, 246, 0.4);
}

/* ‚ù§Ô∏è Red Theme */
[data-theme="red"] {
    --bg-primary: #2b0d0d;
    --bg-secondary: #431313;
    --bg-card: #431313;
    --bg-card-hover: #5b1b1b;
    --text-primary: #fee2e2;
    --text-secondary: #fecaca;
    --text-muted: #fca5a5;
    --primary: #ef4444;
    --primary-dark: #b91c1c;
    --border-primary: rgba(239, 68, 68, 0.3);
}

/* üß° Orange Theme */
[data-theme="orange"] {
    --bg-primary: #331a00;
    --bg-secondary: #4a2500;
    --bg-card: #4a2500;
    --bg-card-hover: #5c2e00;
    --text-primary: #fff7ed;
    --text-secondary: #fed7aa;
    --text-muted: #fdba74;
    --primary: #f97316;
    --primary-dark: #c2410c;
    --border-primary: rgba(249, 115, 22, 0.4);
}

/* üíñ Pink Theme */
[data-theme="pink"] {
    --bg-primary: #2a001a;
    --bg-secondary: #4b0830;
    --bg-card: #4b0830;
    --bg-card-hover: #5c103c;
    --text-primary: #fdf2f8;
    --text-secondary: #fbcfe8;
    --text-muted: #f9a8d4;
    --primary: #ec4899;
    --primary-dark: #db2777;
    --border-primary: rgba(236, 72, 153, 0.3);
}

/* ü©µ Teal Theme */
[data-theme="teal"] {
    --bg-primary: #042f2e;
    --bg-secondary: #134e4a;
    --bg-card: #134e4a;
    --bg-card-hover: #115e59;
    --text-primary: #f0fdfa;
    --text-secondary: #99f6e4;
    --text-muted: #5eead4;
    --primary: #14b8a6;
    --primary-dark: #0d9488;
    --border-primary: rgba(20, 184, 166, 0.3);
}

/* ‚ö´ Gray / Minimalist Theme */
[data-theme="gray"] {
    --bg-primary: #111827;
    --bg-secondary: #1f2937;
    --bg-card: #1f2937;
    --bg-card-hover: #374151;
    --text-primary: #f9fafb;
    --text-secondary: #d1d5db;
    --text-muted: #9ca3af;
    --primary: #6b7280;
    --primary-dark: #4b5563;
    --border-primary: rgba(107, 114, 128, 0.3);
}

/* üß† Cyber / Neon Theme */
[data-theme="cyber"] {
    --bg-primary: #050014;
    --bg-secondary: #0b0220;
    --bg-card: #0b0220;
    --bg-card-hover: #130736;
    --text-primary: #e0f2fe;
    --text-secondary: #93c5fd;
    --text-muted: #60a5fa;
    --primary: #22d3ee;
    --primary-dark: #0ea5e9;
    --secondary: #a855f7;
    --border-primary: rgba(14, 165, 233, 0.4);
}


* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    position: relative;
    min-height: 100vh;
    transition: background-color 0.3s ease, color 0.3s ease;
}

#particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: -2;
}

.gradient-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, var(--darker) 0%, var(--dark) 50%, var(--darker) 100%);
    z-index: -3;
}

.floating-shapes {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.1;
}

.shape {
    position: absolute;
    background: var(--primary);
    border-radius: 50%;
    animation: float 20s infinite linear;
}

.shape:nth-child(1) {
    width: 80px;
    height: 80px;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.shape:nth-child(2) {
    width: 120px;
    height: 120px;
    top: 60%;
    left: 80%;
    animation-delay: -5s;
}

.shape:nth-child(3) {
    width: 60px;
    height: 60px;
    top: 80%;
    left: 20%;
    animation-delay: -10s;
}

.shape:nth-child(4) {
    width: 100px;
    height: 100px;
    top: 40%;
    left: 70%;
    animation-delay: -15s;
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

header {
    background-color: var(--bg-secondary);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid var(--border-primary);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
}

.logo i {
    font-size: 1.8rem;
}

nav ul {
    display: flex;
    list-style: none;
    gap: 25px;
}

nav a {
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
    padding: 5px 0;
}

nav a:hover {
    color: var(--primary);
}

nav a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
}

nav a:hover::after {
    width: 100%;
}

.auth-buttons {
    display: flex;
    gap: 10px;
}

.btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
}

.btn-outline {
    background-color: transparent;
    border: 1px solid var(--primary);
    color: var(--primary);
}

.btn-outline:hover {
    background-color: var(--primary);
    color: white;
    transform: translateY(-2px);
}

.theme-selector {
    position: relative;
    display: flex;
    align-items: center;
    margin-right: 10px;
}

.theme-btn {
    background: var(--bg-card);
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-btn:hover {
    background: var(--bg-card-hover);
    transform: translateY(-2px);
}

.theme-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    min-width: 150px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    display: none;
    z-index: 1000;
}

.theme-dropdown.show {
    display: block;
    animation: fadeInUp 0.3s ease;
}

.theme-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    color: var(--text-primary);
}

.theme-option:hover {
    background: var(--bg-card-hover);
}

.theme-preview {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 2px solid var(--border-primary);
}

.dark-theme { background: linear-gradient(135deg, #8b5cf6 0%, #1a1a2e 50%, #090915 100%); }
.light-theme { background: linear-gradient(135deg, #8b5cf6 0%, #ffffff 50%, #f8fafc 100%); }
.blue-theme { background: linear-gradient(135deg, #3b82f6 0%, #1e293b 50%, #0f172a 100%); }
.green-theme { background: linear-gradient(135deg, #10b981 0%, #14532d 50%, #052e16 100%); }
.purple-theme { background: linear-gradient(135deg, #8b5cf6 0%, #312e81 50%, #1e1b4b 100%); }

.hero {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    color: var(--text-primary);
    padding: 20px 0;
    text-align: center;
    margin-bottom: 40px;
    position: relative;
    overflow: hidden;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" opacity="0.05"><polygon fill="%238b5cf6" points="0,1000 1000,0 1000,1000"/></svg>');
    background-size: cover;
    z-index: -1;
}

.hero h1 {
    font-size: 2.2rem;
    margin-bottom: 15px;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    background-clip: text;          /* standard */
    -webkit-background-clip: text;  /* WebKit prefix */
    -webkit-text-fill-color: transparent;
    text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    animation: fadeInUp 1s ease;
}

.hero p {
    font-size: 1rem;
    max-width: 700px;
    margin: 0 auto 25px;
    color: var(--text-primary);
    animation: fadeInUp 1s ease 0.2s both;
}

.hero-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    animation: fadeInUp 1s ease 0.4s both;
}

.online-users {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 20px 0;
    font-size: 0.9rem;
}

.online-user-count {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 15px;
    background: var(--bg-card);
    border-radius: 20px;
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
}

.online-user-count.registered::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: 50%;
}

.online-user-count.guests::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--primary);
    border-radius: 50%;
}

.section-title {
    text-align: center;
    margin-bottom: 40px;
    font-size: 2.2rem;
    color: var(--text-primary);
    position: relative;
    padding-bottom: 15px;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    border-radius: 3px;
}

.filters {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 15px;
}

.search-box {
    flex: 1;
    min-width: 300px;
    position: relative;
}

.search-box input {
    width: 100%;
    padding: 12px 15px 12px 45px;
    border-radius: 8px;
    border: 1px solid var(--border-primary);
    font-size: 1rem;
    background-color: var(--bg-card);
    color: var(--text-primary);
    transition: all 0.3s ease;
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

.trending-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: linear-gradient(135deg, #ff6b35, #f7931e);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    z-index: 3;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.filter-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 10px 20px;
    background-color: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-primary);
}

.filter-btn.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border-color: var(--primary);
    box-shadow: 0 4px 10px rgba(139, 92, 246, 0.3);
}

.filter-btn:hover:not(.active) {
    border-color: var(--primary);
    transform: translateY(-2px);
}

.scripts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 50px;
}

.script-card {
    background-color: var(--bg-card);
    border: 1px solid var(--border-secondary);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.4s ease;
    position: relative;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
}

.script-card:nth-child(2) {
    animation-delay: 0.1s;
}

.script-card:nth-child(3) {
    animation-delay: 0.2s;
}

.script-card:nth-child(4) {
    animation-delay: 0.3s;
}

.script-card:hover {
    background-color: var(--bg-card-hover);
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--border-primary);
}

.user-created-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(33, 150, 243, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    z-index: 3;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

/* Mobile Menu */
/* Mobile Menu Styles */
.mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.mobile-menu-btn:hover {
    background: var(--bg-card-hover);
}

.mobile-nav {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-secondary);
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
}

.mobile-nav.active {
    transform: translateX(0);
}

.mobile-nav-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-primary);
    background: var(--bg-card);
}

.mobile-nav-header span {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary);
}

.mobile-close-btn {
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.mobile-close-btn:hover {
    background: var(--bg-card-hover);
}

.mobile-nav ul {
    list-style: none;
    padding: 20px;
}

.mobile-nav ul li {
    margin-bottom: 10px;
}

.mobile-nav ul li a {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    color: var(--text-primary);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-size: 1.1rem;
}

.mobile-nav ul li a:hover {
    background: var(--bg-card-hover);
    color: var(--primary);
}

.mobile-nav ul li a i {
    width: 20px;
    text-align: center;
}

.mobile-auth-buttons {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-top: 1px solid var(--border-primary);
}

.mobile-user-info {
    padding: 20px;
    border-top: 1px solid var(--border-primary);
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
}

.mobile-user-info .user-avatar {
    width: 60px;
    height: 60px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .desktop-nav {
        display: none;
    }
    
    .mobile-menu-btn {
        display: block;
    }
    
    .auth-buttons {
        display: none;
    }
    
    .user-info {
        display: none;
    }
    
    .header-content {
        flex-direction: row;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    
    .logo {
        order: 1;
    }
    
    .mobile-menu-btn {
        order: 2;
    }
    
    .theme-selector {
        order: 3;
    }
}

@media (min-width: 769px) {
    .mobile-nav {
        display: none !important;
    }
}

/* ------------ */


.verified-script-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(76, 175, 80, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
    z-index: 3;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.script-category-badge {
    background: rgba(139, 92, 246, 0.2);
    color: var(--primary);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    border: 1px solid var(--primary);
}

.script-image {
    position: relative;
    height: 160px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    position: relative;
    overflow: hidden;
}

.script-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.script-card:hover .script-image img {
    transform: scale(1.05);
}

.script-image::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
    transform: translateX(-100%);
}

.script-card:hover .script-image::after {
    animation: shine 1.5s ease;
}

.script-date-overlay {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.7rem;
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.patched-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(239, 68, 68, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 1.2rem;
    z-index: 2;
}

.script-content {
    padding: 20px;
}

.script-game {
    font-size: 0.9rem;
    color: var(--primary);
    margin-bottom: 5px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 5px;
}

.script-title {
    font-size: 1.3rem;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.script-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.script-actions {
    display: flex;
    justify-content: space-between;
}

.edit-btn {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    color: var(--warning);
}

.edit-btn:hover {
    background: rgba(245, 158, 11, 0.2);
}

.delete-btn {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: var(--danger);
}

.delete-btn:hover {
    background: rgba(239, 68, 68, 0.2);
}

footer {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    padding: 50px 0 20px;
    margin-top: 50px;
    border-top: 1px solid var(--border-primary);
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
}

.footer-column h3 {
    margin-bottom: 20px;
    font-size: 1.2rem;
    color: var(--primary);
}

.footer-column ul {
    list-style: none;
}

.footer-column ul li {
    margin-bottom: 10px;
}

.footer-column a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.footer-column a:hover {
    color: var(--primary);
}


.upload-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.upload-stats {
    display: flex;
    gap: 20px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    background: var(--bg-card-hover);
    border-radius: 8px;
    border: 1px solid var(--border-primary);
    font-size: 0.9rem;
}

.upload-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.upload-tips {
    background: var(--bg-card-hover);
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
    margin-bottom: 20px;
}

.upload-tips h4 {
    margin-bottom: 10px;
    color: var(--primary);
}

.upload-tips ul {
    list-style: none;
    padding: 0;
}

.upload-tips li {
    padding: 5px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.recent-uploads {
    margin-top: 20px;
}

.recent-scripts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.recent-script-card {
    background: var(--bg-card);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--border-secondary);
    transition: all 0.3s ease;
}

.recent-script-card:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
}

@media (max-width: 768px) {
    .upload-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .upload-actions {
        flex-direction: column;
    }
    
    .upload-actions .btn {
        width: 100%;
        justify-content: center;
    }
    
    .recent-scripts-grid {
        grid-template-columns: 1fr;
    }
}




.copyright {
    text-align: center;
    padding-top: 20px;
    border-top: 1px solid var(--border-secondary);
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.error-container {
    display: none;
    text-align: center;
    padding: 100px 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.error-code {
    font-size: 8rem;
    font-weight: 700;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    background-clip: text;          /* standard */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
    margin-bottom: 20px;
    text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.error-message {
    font-size: 1.8rem;
    margin-bottom: 30px;
    color: var(--text-primary);
}

.error-description {
    max-width: 600px;
    margin: 0 auto 40px;
    color: var(--text-secondary);
    font-size: 1.1rem;
    line-height: 1.6;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    position: relative;
    animation: modalSlideIn 0.3s ease;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-title {
    font-size: 1.5rem;
    color: var(--primary);
}

.close-modal {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.3s;
}

.close-modal:hover {
    color: var(--text-primary);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid var(--border-primary);
    background-color: var(--bg-card);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.toggle-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 15px;
}

.toggle-label {
    margin-bottom: 0;
    cursor: pointer;
    color: var(--text-primary);
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--text-secondary);
    transition: .4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: var(--primary);
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

.file-upload {
    position: relative;
    overflow: hidden;
    display: inline-block;
    width: 100%;
}

.file-upload-btn {
    border: 1px dashed var(--border-primary);
    color: var(--primary);
    background-color: rgba(139, 92, 246, 0.1);
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
    width: 100%;
}

.file-upload-btn:hover {
    background-color: rgba(139, 92, 246, 0.2);
    border-color: var(--primary);
}

.file-upload input[type="file"] {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-name {
    margin-top: 8px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.script-details-modal .modal-content {
    max-width: min(800px, 95%);
    padding: 20px;
    position: relative; /* Add this */
    overflow: hidden; /* Add this */
}

.script-details {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.script-details-image {
    flex: 0 0 200px;
    height: 150px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
}

.script-details-image .patched-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(239, 68, 68, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: clamp(1rem, 3vw, 1.2rem);
    z-index: 2;
    text-align: center;
    padding: 10px;
}

.script-details-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.script-details-info {
    flex: 1;
}

.script-details-title {
    font-size: 1.6rem;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.script-details-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 15px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.script-author {
    display: flex;
    align-items: center;
    gap: 5px;
    color: var(--primary);
    font-weight: 500;
}

.script-code {
    background-color: var(--bg-secondary);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
    max-height: 300px;
    overflow-y: auto;
    position: relative;
    border: 1px solid var(--border-secondary);
    box-shadow: 0 4px 25px rgba(226, 3, 3, 0.2);
    scrollbar-width: thin;
    scrollbar-color: rgba(139, 92, 246, 0.8) rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}

.script-code pre {
    white-space: pre-wrap;
    color: var(--text-primary);
    font-family: 'Courier New', monospace;
    margin: 0;
    font-size: 0.95rem;
}

.script-code::-webkit-scrollbar {
    width: 10px;
}

.script-code::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.15);
    border-radius: 10px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
}

.script-code::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--primary), var(--primary-dark));
    border-radius: 10px;
    border: 2px solid rgba(0, 0, 0, 0.15);
    box-shadow: 0 0 8px rgba(139, 92, 246, 0.6);
    transition: all 0.3s ease;
    animation: thumbGlow 2s infinite alternate;
}

.script-code::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, var(--primary-dark), var(--primary));
    box-shadow: 0 0 12px rgba(139, 92, 246, 0.9);
}

@keyframes thumbGlow {
    0%, 100% { box-shadow: 0 0 8px rgba(139,92,246,0.6); }
    50% { box-shadow: 0 0 15px rgba(139,92,246,1); }
}

.script-actions-details {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    background: rgba(139, 92, 246, 0.08);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 8px;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.action-btn:hover {
    background: rgba(139, 92, 246, 0.18);
    transform: translateY(-2px);
}

.profile-section {
    background-color: var(--bg-card);
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 40px;
    border: 1px solid var(--border-primary);
    display: none;
}

.profile-header {
    background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-card-hover) 100%);
    border: 1px solid var(--border-primary);
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding: 30px;
    border-radius: 16px;
}

.profile-avatar-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}

.profile-picture-btn {
    padding: 8px 15px;
    font-size: 0.8rem;
    white-space: nowrap;
}

.profile-avatar-edit {
    display: none; /* Hide the old edit icon */
}


.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    position: relative;
    overflow: hidden;
}

.profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-avatar-edit {
    position: absolute;
    bottom: 0;
    right: 0;
    background: var(--primary);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.8rem;
    border: 2px solid var(--bg-card);
    z-index: 2;
}

.profile-info h2 {
    font-size: 1.8rem;
    margin-bottom: 5px;
    color: var(--text-primary);
}

.profile-info p {
    color: var(--text-secondary);
}

.profile-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: var(--bg-card);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    border: 1px solid var(--border-secondary);
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.profile-tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border-primary);
}

.profile-tab {
    padding: 10px 20px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
    color: var(--text-secondary);
}

.profile-tab.active {
    color: var(--primary);
    border-bottom: 2px solid var(--primary);
}

.profile-tab-content {
    display: none;
}

.profile-tab-content.active {
    display: block;
}

.profile-layout {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 30px;
}

.profile-sidebar {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid var(--border-secondary);
    height: fit-content;
}

.profile-main {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid var(--border-secondary);
}

.profile-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.profile-action-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 15px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 8px;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    text-align: left;
}

.profile-action-btn:hover {
    background: rgba(139, 92, 246, 0.2);
}

.loader {
    display: none;
    width: 50px;
    height: 50px;
    border: 5px solid rgba(139, 92, 246, 0.3);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
    margin: 30px auto;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.ip-status {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--bg-card);
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 0.8rem;
    border: 1px solid var(--border-primary);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 8px;
    max-width: 250px;
    word-break: break-word;
    color: var(--text-primary);
}

.ip-status.allowed {
    border-color: var(--success);
    color: var(--success);
}

.ip-status.denied {
    border-color: var(--danger);
    color: var(--danger);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    overflow: hidden;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.upload-section {
    background-color: var(--bg-card);
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 40px;
    border: 1px solid var(--border-primary);
    display: none;
}

.upload-section h3 {
    margin-bottom: 20px;
    color: var(--primary);
}

.notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    background-color: var(--success);
    color: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s ease;
}

.notification.show {
    transform: translateY(0);
    opacity: 1;
}

.notification.error {
    background-color: var(--danger);
}

.game-id-loading {
    display: none;
    color: var(--primary);
    font-size: 0.9rem;
    margin-top: 5px;
}

.key-icon {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--warning);
    border: 1px solid var(--warning);
    z-index: 3;
}

.favorite-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 1.2rem;
    transition: color 0.3s;
}

.favorite-btn.active {
    color: var(--warning);
}

.favorite-btn:hover {
    color: var(--warning);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes shine {
    to {
        transform: translateX(100%);
    }
}

@keyframes float {
    0%, 100% {
        transform: translateY(0) rotate(0deg);
    }
    33% {
        transform: translateY(-20px) rotate(120deg);
    }
    66% {
        transform: translateY(10px) rotate(240deg);
    }
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}
/* === üíª RESPONSIVE DESIGN ADDITIONS === */

/* üîπ Small devices (phones, < 600px) */
@media (max-width: 600px) {

    /* Header adjustments */
    .header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }

    nav ul {
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }

    .auth-buttons {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
    }

    .theme-selector {
        margin-top: 10px;
    }

    /* Hero section */
    .hero {
        padding: 40px 15px;
    }

  .hero h1 {
        font-size: 1.5rem;
        line-height: 1.3;
    }
    
    .hero p {
        font-size: 0.9rem;
    }
    
     .hero-buttons {
        flex-direction: column;
        gap: 10px;
    }

    /* Filters and search */
    .filters {
        flex-direction: column;
        gap: 10px;
    }

    .search-box {
        min-width: 100%;
    }

    .filter-options {
        justify-content: center;
    }

    /* Grid items */
    .scripts-grid {
        grid-template-columns: 1fr;
         gap: 15px;
    }

    /* Profile layout */
    .profile-layout {
        grid-template-columns: 1fr;
    }

    .script-details {
        flex-direction: column;
        align-items: center;
    }

    .script-details-image {
        width: 100%;
        height: 200px;
    }

    /* Footer */
    .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
    }

    .footer-column ul {
        padding: 0;
    }

    /* Modals */
    .modal-content {
       width: 95%;
        margin: 20px auto;
        padding: 20px;
    }

    .script-code {
        max-height: 250px;
        font-size: 0.9rem;
    }

    /* Buttons and text */
    .btn, .filter-btn {
        width: 100%;
        justify-content: center;
    }

    .online-users {
        flex-direction: column;
        gap: 10px;
    }

    .online-user-count {
        width: 100%;
        justify-content: center;
    }
}

/* üîπ Medium devices (tablets, 600px‚Äì900px) */
@media (min-width: 601px) and (max-width: 900px) {

    .header-content {
        flex-wrap: wrap;
        gap: 10px;
    }

    nav ul {
        flex-wrap: wrap;
        justify-content: center;
    }

    .hero {
        padding: 50px 25px;
    }

    .hero h1 {
        font-size: 2rem;
    }

    .scripts-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }

    .profile-layout {
        grid-template-columns: 1fr;
    }

    .script-details {
        flex-direction: column;
    }

    .footer-content {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    .container {
        padding: 0 15px;
    }
}

/* üîπ Large devices (desktop, 900px‚Äì1400px) */
@media (min-width: 901px) and (max-width: 1400px) {
    .container {
        max-width: 1100px;
    }

    .scripts-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }

    .profile-layout {
        grid-template-columns: 1fr 1.5fr;
    }

    .hero h1 {
        font-size: 2.3rem;
    }
}

/* üîπ Extra large (ultrawide) */
@media (min-width: 1401px) {
    .container {
        max-width: 1400px;
    }

    .hero h1 {
        font-size: 2.6rem;
    }

    .hero p {
        font-size: 1.1rem;
    }
}

@media (max-width: 768px) {
    body {
        font-size: 14px;
    }
    
    .section-title {
        font-size: 1.5rem;
    }
    
    .script-title {
        font-size: 1.1rem;
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.floating {
    animation: float 5s ease-in-out infinite;
}

.pulse {
    animation: pulse 2s ease-in-out infinite;
}

@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 15px;
        padding: 10px 0;
    }
    
     nav {
        order: 3;
        width: 100%;
    }

     nav ul {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    
     nav a {
        font-size: 0.9rem;
        padding: 5px;
    }

    .hero h1 {
        font-size: 1.8rem;
    }
    
    .hero p {
        font-size: 0.9rem;
    }
    
    .hero-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .filters {
        flex-direction: column;
    }
    
    .search-box {
        min-width: 100%;
    }
    
    .scripts-grid {
        grid-template-columns: 1fr;
    }
    
    .script-details {
        flex-direction: column;
    }
    
    .script-details-image {
        flex: 0 0 auto;
         width: 100%;
        height: 150px;
    }
    
    .script-actions-details {
        justify-content: center;
    }
    
    .ip-status {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 10px;
        font-size: 0.7rem;
        padding: 8px 12px;
    }
    
    .profile-header {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-layout {
        grid-template-columns: 1fr;
    }
    
    .online-users {
        flex-direction: column;
        gap: 10px;
    }
    
    .theme-dropdown {
        right: -50px;
    }
}
</style>
</head>
<body>
    <!-- Advanced Background Effects -->
    <div class="gradient-bg"></div>
    <div id="particles-js"></div>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>
    
    <!-- IP Status Indicator -->
    <div id="ipStatus" class="ip-status">
        <i class="fas fa-circle-notch fa-spin"></i>
        <span>Checking IP...</span>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Login to SeraphBlox</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            
            <p style="text-align: center; margin-top: 15px;">
                <a href="#" id="forgotPassword" style="color: var(--primary);">Forgot password?</a>
                Don't have an account? <a href="#" id="showSignup" style="color: var(--primary);">Sign up</a>
            </p>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Account</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" required>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                Already have an account? <a href="#" id="showLogin" style="color: var(--primary);">Login</a>
            </p>
        </div>
    </div>

    <!-- Upload Script Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Upload Script</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="uploadForm">
                <div class="form-group">
                    <label for="scriptTitle">Script Title</label>
                    <input type="text" id="scriptTitle" required>
                </div>
                <div class="form-group">
                    <label for="gameId">Roblox Game ID (0 = Universal)</label>
                    <input type="number" id="gameId" required placeholder="Enter Roblox Game ID">
                    <div id="gameIdLoading" class="game-id-loading">
                        <i class="fas fa-spinner fa-spin"></i> Fetching game name...
                    </div>
                    <div id="gameNameDisplay" style="margin-top: 5px; font-size: 0.9rem; color: var(--primary);"></div>
                </div>
                <div class="form-group">
                    <label for="scriptImage">Script Image (Optional)</label>
                    <div class="file-upload">
                        <div class="file-upload-btn">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Choose File (JPEG, PNG)
                        </div>
                        <input type="file" id="scriptImage" accept=".jpg,.jpeg,.png">
                    </div>
                    <div id="fileName" class="file-name"></div>
        <div id="imagePreviewContainer" style="margin-top: 10px; display: none;">
        <img id="imagePreview" src="" alt="Image Preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid var(--primary);">
    </div>

                </div>
                <div class="form-group">
                    <label for="scriptCode">Script Code</label>
                    <textarea id="scriptCode" required placeholder="Paste your script code here..."></textarea>
                </div>
                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="isPatched">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="isPatched" class="toggle-label">Mark as Patched</label>
                </div>
                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="keySystemToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="keySystemToggle" class="toggle-label">Enable Key System</label>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Upload Script</button>
            </form>
        </div>
    </div>

    <!-- Edit Script Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Script</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editScriptId">
                <div class="form-group">
                    <label for="editScriptTitle">Script Title</label>
                    <input type="text" id="editScriptTitle" required>
                </div>
                <div class="form-group">
                    <label for="editGameId">Roblox Game ID (0 = Universal)</label>
                    <input type="number" id="editGameId" required placeholder="Enter Roblox Game ID">
                    <div id="editGameIdLoading" class="game-id-loading">
                        <i class="fas fa-spinner fa-spin"></i> Fetching game name...
                    </div>
                    <div id="editGameNameDisplay" style="margin-top: 5px; font-size: 0.9rem; color: var(--primary);"></div>
                </div>
                <div class="form-group">
                    <label for="editScriptImage">Script Image (Optional)</label>
                    <div class="file-upload">
                        <div class="file-upload-btn">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Choose File (JPEG, PNG)
                        </div>
                        <input type="file" id="editScriptImage" accept=".jpg,.jpeg,.png">
                    </div>
                    <div id="editFileName" class="file-name"></div>
                      <!-- Current image preview -->
    <div id="editImagePreviewContainer" style="margin-top: 10px; display: none;">
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">Current Image:</p>
        <img id="editImagePreview" src="" alt="Current Image" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid var(--primary);">
    </div>
    <!-- New image preview -->
    <div id="editNewImagePreviewContainer" style="margin-top: 10px; display: none;">
        <p style="font-size: 0.8rem; color: var(--gray); margin-bottom: 5px;">New Image Preview:</p>
        <img id="editNewImagePreview" src="" alt="New Image Preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px dashed var(--primary);">
    </div>
                </div>
                <div class="form-group">
                    <label for="editScriptCode">Script Code</label>
                    <textarea id="editScriptCode" required placeholder="Paste your script code here..."></textarea>
                </div>
                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="editIsPatched">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="editIsPatched" class="toggle-label">Mark as Patched</label>
                </div>
                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="editKeySystemToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="editKeySystemToggle" class="toggle-label">Enable Key System (Shows key icon on script)</label>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Update Script</button>
            </form>
        </div>
    </div>

    <!-- Script Details Modal - Improved with author info and single close button -->
    <div id="scriptDetailsModal" class="modal script-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="detailsTitle">Script Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="script-details">
                <div class="script-details-image">
                    <img id="detailsImage" src="https://cdn-icons-png.flaticon.com/512/2721/2721620.png" alt="Script Icon">
                </div>
                <div class="script-details-info">
                    <h3 class="script-details-title" id="detailsScriptTitle">Script Title</h3>
                    <div class="script-details-meta">
                        <span><i class="fas fa-download"></i> <span id="detailsDownloads">0</span> views</span>
                        <span><i class="fas fa-calendar"></i> <span id="detailsDate">Just now</span></span>
                        <span class="script-author"><i class="fas fa-user"></i> <span id="detailsAuthor">Unknown</span></span>
                    </div>
                      <div id="patchedOverlay" class="patched-overlay" style="display: none;">
                       PATCHED
            </div>
                </div>
            </div>
            <div class="script-code">
                <pre><code class="language-lua" id="detailsCode">// Script code will appear here</code></pre>
            </div>
            <div class="script-actions-details">
                <button class="btn btn-primary" onclick="copyScriptFromDetails()">
                    <i class="fas fa-copy"></i> Copy Script
                </button>
                <a class="action-btn" id="viewRawBtn" target="_blank">
                    <i class="fas fa-code"></i> View Raw
                </a>
                <a class="action-btn" id="downloadBtn" download="script.lua">
                    <i class="fas fa-download"></i> Download
                </a>
                <a class="action-btn" id="gameBtn" target="_blank">
                    <i class="fas fa-gamepad"></i> View Game
                </a>
            </div>
        </div>
    </div>

    <!-- Profile Picture Upload Modal -->
    <div id="profilePictureModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Change Profile Picture</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="profilePicture">Select New Profile Picture</label>
                <div class="file-upload">
                    <div class="file-upload-btn">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Choose File (JPEG, PNG)
                    </div>
                    <input type="file" id="profilePicture" accept=".jpg,.jpeg,.png">
                </div>
                <div id="profilePictureName" class="file-name"></div>
            </div>
            <div class="preview-container" style="margin-top: 20px; text-align: center;">
                <div style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; margin: 0 auto; border: 2px solid var(--primary);">
                    <img id="profilePicturePreview" src="" alt="Preview" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="saveProfilePicture">Save Profile Picture</button>
        </div>
    </div>

    <!-- Main Content (Visible only if IP is allowed) -->
    <div id="main-content" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo floating">
                        <i class="fas fa-code"></i>
                        <span>SeraphBlox</span>
                  </div>
            
            <!-- Desktop Navigation -->
            <nav class="desktop-nav">
                <ul>
                    <li><a href="#" class="nav-link" data-section="home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" class="nav-link" data-section="trending"><i class="fas fa-fire"></i> Trending</a></li>
                    <li><a href="#" class="nav-link" data-section="profile"><i class="fas fa-user"></i> Profile</a></li>
                    <li><a href="#" class="nav-link" data-section="premium"><i class="fas fa-crown"></i> Premium</a></li>
                    <li><a href="#" class="nav-link" data-section="community"><i class="fas fa-users"></i> Community</a></li>
                </ul>
            </nav>

            <!-- Mobile Hamburger Button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Mobile Navigation Menu -->
            <div class="mobile-nav" id="mobileNav">
                <div class="mobile-nav-header">
                    <span>Menu</span>
                    <button class="mobile-close-btn" id="mobileCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <ul>
                    <li><a href="#" class="nav-link mobile-link" data-section="home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" class="nav-link mobile-link" data-section="trending"><i class="fas fa-fire"></i> Trending</a></li>
                    <li><a href="#" class="nav-link mobile-link" data-section="profile"><i class="fas fa-user"></i> Profile</a></li>
                    <li><a href="#" class="nav-link mobile-link" data-section="premium"><i class="fas fa-crown"></i> Premium</a></li>
                    <li><a href="#" class="nav-link mobile-link" data-section="community"><i class="fas fa-users"></i> Community</a></li>
                </ul>
                <!-- Add auth buttons to mobile menu -->
                <div class="mobile-auth-buttons" id="mobileAuthButtons">
                    <button class="btn btn-outline" id="mobileLoginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
                    <button class="btn btn-primary" id="mobileSignupBtn"><i class="fas fa-user-plus"></i> Sign Up</button>
                </div>
                <div class="mobile-user-info" id="mobileUserInfo" style="display: none;">
                    <div class="user-avatar">
                        <img id="mobileUserAvatarImg" src="" alt="User Avatar" style="display: none;">
                        <span id="mobileUserAvatarText">U</span>
                    </div>
                    <span id="mobileUsername">User</span>
                    <button class="btn btn-outline" id="mobileLogoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </div>

                    <div class="auth-buttons" id="authButtons">
                        <button class="btn btn-outline" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
                        <button class="btn btn-primary" id="signupBtn"><i class="fas fa-user-plus"></i> Sign Up</button>
                    </div>
                    <div class="user-info" id="userInfo" style="display: none;">
                        <div class="user-avatar" id="userAvatar">
                            <img id="userAvatarImg" src="" alt="User Avatar" style="display: none;">
                            <span id="userAvatarText">U</span>
                        </div>
                        <span id="username">User</span>
                        <button class="btn btn-outline" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
              
              <!-- Add this in your header, inside .header-content -->
<div class="theme-selector">
    <button class="theme-btn" id="themeToggle" title="Change Theme">
        <i class="fas fa-palette"></i>
    </button>

    <div class="theme-dropdown" id="themeDropdown">
        <div class="theme-option" data-theme="dark">
            <div class="theme-preview dark-theme"></div>
            <span>Dark</span>
        </div>
        <div class="theme-option" data-theme="light">
            <div class="theme-preview light-theme"></div>
            <span>Light</span>
        </div>
        <div class="theme-option" data-theme="blue">
            <div class="theme-preview blue-theme"></div>
            <span>Blue</span>
        </div>
      
      
        <div class="theme-option" data-theme="cyber">
            <div class="theme-preview cyber-theme"></div>
            <span>Cyber</span>
        </div>
    </div>
</div>

              
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="home-section" class="section">
            <section class="hero">
                <div class="container">
                    <h1>The best Lua scripts, all in one place.</h1>
                    <p>Made by the community. For the community.</p>

                    
                    <!-- Online Users Display -->
                    <div class="online-users">
                        <div class="online-user-count registered">
                            <span id="registeredUsers">402</span> Registered users online
                        </div>
                        <div class="online-user-count guests">
                            <span id="guestUsers">3260</span> Guests online
                        </div>
                    </div>
                    
                    <div class="hero-buttons">
                        <button class="btn btn-primary" id="exploreScripts">
                            <i class="fas fa-rocket"></i> Explore Scripts
                        </button>
                        <button class="btn btn-outline" id="uploadScriptBtn">
                            <i class="fas fa-upload"></i> Upload Script
                        </button>
                    </div>
                </div>
            </section>

            <section class="container">

   <div class="upload-section" id="uploadSection">
    <div class="upload-header">
        <h3><i class="fas fa-upload"></i> Upload Manager</h3>
        <div class="upload-stats">
            <div class="stat-item">
                <i class="fas fa-file-code"></i>
                <span id="userScriptCount">0</span> Scripts
            </div>
            <div class="stat-item">
                <i class="fas fa-eye"></i>
                <span id="totalViews">0</span> Total Views
            </div>
        </div>
    </div>
    
    <div class="upload-actions">
        <button class="btn btn-primary" id="openUploadModal">
            <i class="fas fa-plus"></i> Upload New Script
        </button>
       
    </div>
    

    <div class="recent-uploads" id="recentUploads" style="display: none;">
        <h4><i class="fas fa-history"></i> Recent Uploads</h4>
        <div class="recent-scripts-grid" id="recentScriptsGrid">
            <!-- Recent scripts will appear here -->
        </div>
    </div>
</div>


                <h2 class="section-title">Featured Scripts</h2>
                
                <div class="filters">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search scripts...">
                    </div>
                    <div class="filter-options">
                        <div class="filter-btn active" data-filter="all">All</div>
                        <div class="filter-btn" data-filter="game">Game</div>
                    </div>
                </div>
                
                <div class="scripts-grid" id="scriptsGrid">
                    <!-- Scripts will be dynamically added here -->
                </div>
            </section>
        </section>

        <!-- Profile Section -->
        <section id="profile-section" class="section" style="display: none;">
            <div class="container">
                <div class="profile-section" id="userProfileSection">
                    <div class="profile-header">
                       <div class="profile-avatar-container">
    <div class="profile-avatar" id="profileAvatar">
        <img id="profileAvatarImg" src="" alt="Profile Avatar" style="display: none;">
        <span id="profileAvatarText">U</span>
    </div>
    <button class="btn btn-primary profile-picture-btn" id="changeProfilePictureBtn">
        <i class="fas fa-camera"></i> Change Picture
    </button>
</div>
                        <div class="profile-info">
                            <h2 id="profileUsername">Username</h2>
                            <p id="profileEmail">user@example.com</p>
                        </div>
                    </div>
                    
                    <div class="profile-tabs">
                        <div class="profile-tab active" data-tab="scripts">My Scripts</div>
                        <div class="profile-tab" data-tab="favorites">Favorites</div>
                        <div class="profile-tab" data-tab="info">Profile Info</div>
                    </div>
                    
                    <div class="profile-layout">
                        <div class="profile-sidebar">
                            <h3>Account Information</h3>
                            <div class="profile-stats">
                                <div class="stat-card">
                                    <div class="stat-number" id="statScripts">0</div>
                                    <div class="stat-label">Scripts Uploaded</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="statViews">0</div>
                                    <div class="stat-label">Total Views</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="statDownloads">0</div>
                                    <div class="stat-label">Total Downloads</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="statJoined">0</div>
                                    <div class="stat-label">Days Joined</div>
                                </div>
                            </div>
                            
                            <div class="profile-actions">
                                <button class="profile-action-btn" id="viewPublicProfileBtn">
                                    <i class="fas fa-eye"></i> View Public Profile
                                </button>
                                <button class="profile-action-btn" id="connectDiscordBtn">
                                    <i class="fab fa-discord"></i> Connect to Discord
                                </button>
                                <button class="profile-action-btn" id="changePasswordBtn">
                                    <i class="fas fa-key"></i> Change Password
                                </button>
                                <button class="profile-action-btn" id="changeEmailBtn">
                                    <i class="fas fa-envelope"></i> Change Email
                                </button>
                                 <button class="profile-action-btn" id="resendVerificationBtn" style="display: none;">
                                 <i class="fas fa-envelope"></i> Resend Verification Email
                             </button>
                            </div>
                        </div>
                        
                        <div class="profile-main">
                            <div class="profile-tab-content active" id="scripts-tab">
                                <h3 style="margin-bottom: 20px; color: var(--primary);">My Scripts</h3>
                                <div class="scripts-grid" id="userScriptsGrid">
                                    <!-- User scripts will be dynamically added here -->
                                </div>
                            </div>
                            
                            <div class="profile-tab-content" id="favorites-tab">
                                <h3 style="margin-bottom: 20px; color: var(--primary);">Favorite Scripts</h3>
                                <div class="scripts-grid" id="favoriteScriptsGrid">
                                    <!-- Favorite scripts will be dynamically added here -->
                                </div>
                            </div>
                            
                            <div class="profile-tab-content" id="info-tab">
                                <h3 style="margin-bottom: 20px; color: var(--primary);">Profile Information</h3>
                                <div class="form-group">
                                    <label for="profileDisplayName">Display Name</label>
                                    <input type="text" id="profileDisplayName" value="Username">
                                </div>
                                <div class="form-group">
                                    <label for="profileBio">Bio</label>
                                    <textarea id="profileBio" placeholder="Tell us about yourself..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="profileWebsite">Website</label>
                                    <input type="url" id="profileWebsite" placeholder="https://example.com">
                                </div>
                                <button class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Other Sections (Placeholders) -->
        <section id="trending-section" class="section" style="display: none;">
            <div class="container">
                <h2 class="section-title">Trending Scripts</h2>
                <div class="scripts-grid" id="trendingScriptsGrid">
                    <!-- Trending scripts will be dynamically added here -->
                </div>
            </div>
        </section>

        <section id="premium-section" class="section" style="display: none;">
            <div class="container">
                <h2 class="section-title">Premium Scripts</h2>
                <p style="text-align: center; color: var(--gray); margin-bottom: 30px;">Upgrade to premium to access exclusive scripts and features!</p>
                <div class="scripts-grid" id="premiumScriptsGrid">
                    <!-- Premium scripts will be dynamically added here -->
                </div>
            </div>
        </section>

        <section id="community-section" class="section" style="display: none;">
            <div class="container">
                <h2 class="section-title">Community</h2>
                <p style="text-align: center; color: var(--gray);">Community features coming soon!</p>
            </div>
        </section>

        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-column">
                        <h3>SeraphBlox</h3>
                        <ul>
                            <li><a href="#" class="footer-link" data-page="about"><i class="fas fa-chevron-right"></i> About Us</a></li>
                            <li><a href="#" class="footer-link" data-page="team"><i class="fas fa-chevron-right"></i> Our Team</a></li>
                            <li><a href="#" class="footer-link" data-page="careers"><i class="fas fa-chevron-right"></i> Careers</a></li>
                            <li><a href="#" class="footer-link" data-page="press"><i class="fas fa-chevron-right"></i> Press</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Resources</h3>
                        <ul>
                            <li><a href="#" class="footer-link" data-page="docs"><i class="fas fa-chevron-right"></i> Documentation</a></li>
                            <li><a href="#" class="footer-link" data-page="tutorials"><i class="fas fa-chevron-right"></i> Tutorials</a></li>
                            <li><a href="#" class="footer-link" data-page="api"><i class="fas fa-chevron-right"></i> API</a></li>
                            <li><a href="#" class="footer-link" data-page="support"><i class="fas fa-chevron-right"></i> Support</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Legal</h3>
                        <ul>
                            <li><a href="#" class="footer-link" data-page="terms"><i class="fas fa-chevron-right"></i> Terms of Service</a></li>
                            <li><a href="#" class="footer-link" data-page="privacy"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
                            <li><a href="#" class="footer-link" data-page="cookies"><i class="fas fa-chevron-right"></i> Cookie Policy</a></li>
                            <li><a href="#" class="footer-link" data-page="dmca"><i class="fas fa-chevron-right"></i> DMCA</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Connect</h3>
                        <ul>
                            <li><a href="https://discord.gg/example" target="_blank"><i class="fab fa-discord"></i> Discord</a></li>
                            <li><a href="https://twitter.com/example" target="_blank"><i class="fab fa-twitter"></i> Twitter</a></li>
                            <li><a href="https://youtube.com/example" target="_blank"><i class="fab fa-youtube"></i> YouTube</a></li>
                            <li><a href="https://github.com/example" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
                        </ul>
                    </div>
                </div>
                <div class="copyright">
                    &copy; 2023 SeraphBlox. All rights reserved.
                </div>
            </div>
        </footer>
    </div>

    <!-- 404 Error Page (Visible only if IP is not allowed) -->
    <div id="error-content" class="error-container" style="display: none;">
        <div class="error-code">404</div>
        <div class="error-message">Access Denied</div>
        <div class="error-description">
            Your IP address is not authorized to access this website. If you believe this is an error, please contact the administrator.
        </div>
    </div>

    <!-- Loading Animation -->
    <div id="loader" class="loader" style="display: none;"></div>

    <!-- Particles.js Library -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>


<script type="module">
    let OwAllowed = false;
    let currentUser = null;
    let currentEditingScript = null;
    let userFavorites = new Set();

    // Firebase v9 modular imports
   // Complete Firebase v9 modular imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    updateProfile, 
    signOut, 
    onAuthStateChanged,
    sendPasswordResetEmail,
    sendEmailVerification
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { 
    getFirestore, 
    collection, 
    addDoc, 
    getDocs, 
    doc, 
    getDoc, 
    updateDoc, 
    deleteDoc, 
    query, 
    where, 
    orderBy, 
    serverTimestamp, 
    setDoc, 
    limit 
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { 
    getStorage, 
    ref, 
    uploadBytes
} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";



    // Your Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyDUTt30o4YabDE99d_AbzHhzeVHtipXpfg",
  authDomain: "gameweb-c16c7.firebaseapp.com",
  projectId: "gameweb-c16c7",
  storageBucket: "gameweb-c16c7.firebasestorage.app",
  messagingSenderId: "814155366163",
  appId: "1:814155366163:web:688839c930f82c17c7a4e6",
  measurementId: "G-83X3JTDRVT"
};

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
  //  const storage = getStorage(app);

  let UrlWeb = "gameweb-c16c7.firebaseapp.com";
  (function() {
    const allowedIPs = [
        "173.88.55.47",
        "2001:0db8:85a3:0000:0000:8a2e:0370:7334" // example IPv6
    ];

    const ipStatus = document.getElementById('ipStatus');
    const mainContent = document.getElementById('main-content');
    const errorContent = document.getElementById('error-content');

  const ipServices = [
    // Primary services (your original list)
    'https://api.ipify.org?format=json',
    'https://ip.seeip.org/jsonip?',
    'https://api.myip.com',
    
    // Additional reliable services
    'https://api.ip.sb/jsonip',
    'https://ipinfo.io/json',
    'https://ipapi.co/json/',
    'https://jsonip.com',
    'https://worldtimeapi.org/api/ip',
    'https://httpbin.org/ip',
    'https://icanhazip.com',
    'https://ident.me',
    'https://ipecho.net/plain',
    'https://checkip.amazonaws.com',
    'https://ip.seeip.org',
    'https://api64.ipify.org?format=json',
    'https://ipv4.seeip.org/jsonip'
];
    const ipCheckTimeout = setTimeout(() => {
        if (ipStatus) {
            ipStatus.className = 'ip-status denied';
            ipStatus.innerHTML = `<i class="fas fa-times-circle"></i><span>IP Check Timeout</span>`;
        }
        window.location.href = '404.html';
    }, 10000);

    function normalizeIP(ip) {
        return ip.trim().toLowerCase();
    }

    function checkIP(ip) {
        const normalizedIP = normalizeIP(ip);
        const isAllowed = allowedIPs.some(allowed => normalizeIP(allowed) === normalizedIP);

        if (ipStatus) {
            ipStatus.className = `ip-status ${isAllowed ? 'allowed' : 'denied'}`;
            ipStatus.innerHTML = isAllowed
                ? `<i class="fas fa-check-circle"></i><span>IP: ${normalizedIP} (Allowed)</span>`
                : `<i class="fas fa-times-circle"></i><span>IP: ${normalizedIP} (Denied)</span>`;
        }

        if (isAllowed) {
            if (mainContent) mainContent.style.display = 'block';
            if (errorContent) errorContent.style.display = 'none';
            if (typeof initApplication === 'function') initApplication();
        } else {
            if (mainContent) mainContent.style.display = 'none';
            if (errorContent) errorContent.style.display = 'block';
            window.location.href = '404.html';
        }
    }

    async function getIPFromServices(services) {
        const fetchPromises = services.map(async service => {
            try {
                const response = await fetch(service, { cache: 'no-cache' });
                if (!response.ok) throw new Error('Bad response');
                const data = await response.json();
                return data.ip || data.ip_address || data.IP || null;
            } catch (e) {
                console.warn(`IP service failed: ${service}`, e);
                return null;
            }
        });

        const results = await Promise.all(fetchPromises);
        const validIPs = results.filter(ip => ip !== null);

        if (validIPs.length === 0) throw new Error('All IP services failed');

        // Majority vote
        const ipCounts = {};
        for (const ip of validIPs) {
            const normalized = normalizeIP(ip);
            ipCounts[normalized] = (ipCounts[normalized] || 0) + 1;
        }

        // Find the IP with the highest count
        let majorityIP = null;
        let maxCount = 0;
        for (const [ip, count] of Object.entries(ipCounts)) {
            if (count > maxCount) {
                maxCount = count;
                majorityIP = ip;
            }
        }

        return majorityIP;
    }

    getIPFromServices(ipServices)
        .then(ip => {
            clearTimeout(ipCheckTimeout);
            console.log("Detected IP (majority):", ip);
            checkIP(ip);
        })
        .catch(error => {
            console.error("IP check failed:", error);
            clearTimeout(ipCheckTimeout);
            if (ipStatus) {
                ipStatus.className = 'ip-status denied';
                ipStatus.innerHTML = `<i class="fas fa-times-circle"></i><span>IP Check Failed</span>`;
            }
            window.location.href = '404.html';
        });
})();





        
        // Current user
      //  let currentUser = null;
      //  let currentEditingScript = null;
     //   let userFavorites = new Set();

        // Initialize sample data if collection is empty
   // Initialize sample data if collection is empty
async function initializeSampleData() {
    try {
        const scriptsSnapshot = await getDocs(
            query(
                collection(db, 'scripts'), 
                limit(1)
            )
        );
        
        // Only create sample data if collection is empty
        if (scriptsSnapshot.empty) {
            console.log("Creating sample scripts...");
            
    const sampleScripts = [
    {
        title: "Infinite Yield FE",
        game: "Universal Script üìå",
        gameId: "0",
        code: `loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()`,
        patched: false,
        requiresKey: false,
        Views: 0,  // Changed from downloads to Views
        copyCount: 0,
        author: "system",
        authorName: "System",
        createdAt: serverTimestamp()
    },
    {
        title: "Admin Commands",
        game: "Adopt Me",
        gameId: "920587237",
        code: `-- Admin Commands Script
print("Admin panel loaded")
-- Add your admin commands here`,
        patched: false,
        requiresKey: false,
        Views: 0,  // Changed from downloads to Views
        copyCount: 0,
        author: "system",
        authorName: "System",
        createdAt: serverTimestamp()
    },
    {
        title: "Auto Farm",
        game: "Blox Fruits",
        gameId: "2753915549",
        code: `-- Auto Farm Script
while wait(1) do
    -- Auto farm logic here
    print("Farming...")
end`,
        patched: false,
        requiresKey: true,
        Views: 0,  // Changed from downloads to Views
        copyCount: 0,
        author: "system",
        authorName: "System",
        createdAt: serverTimestamp()
    }
];
            
            // Add sample scripts using modular syntax
            for (const script of sampleScripts) {
                await addDoc(collection(db, 'scripts'), script);
            }
            
            console.log("Sample data created successfully!");
        }
    } catch (error) {
        console.error("Error initializing sample data:", error);
        // Don't show error notification for sample data initialization
    }
}
let currentIP = null;
let lastUpdateTime = 0;
let skipGuestOnSignOut = false;
let sessionId = sessionStorage.getItem('sessionId') || crypto.randomUUID();
sessionStorage.setItem('sessionId', sessionId);

const ipServices = [
  'https://api.ipify.org?format=json',
  'https://api64.ipify.org?format=json',
  'https://ipapi.co/json/',
  'https://ipinfo.io/json',
  'https://api.ip.sb/jsonip',
  'https://ip.seeip.org/jsonip',
  'https://ipv4.seeip.org/jsonip',
  'https://jsonip.com',
  'https://ipwhois.io/json/',
  'https://ip-api.com/json/',
  'https://extreme-ip-lookup.com/json/'
];

async function fetchWithTimeout(url, timeout = 5000) {
  return Promise.race([
    fetch(url),
    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), timeout))
  ]);
}

async function getClientIP() {
  if (currentIP) return currentIP;
  const results = await Promise.all(ipServices.map(async service => {
    try {
      const response = await fetchWithTimeout(service, 5000);
      if (!response.ok) return null;

      const text = await response.text();
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        return null; // skip non-JSON responses
      }
      return data.ip || data.ipAddress || data.IP || data.query || null;
    } catch { return null; }
  }));
  const validIPs = results.filter(ip => ip);
  if (!validIPs.length) {
    currentIP = 'guest_' + Date.now() + '_' + crypto.randomUUID();
    return currentIP;
  }
  const counts = {};
  validIPs.forEach(ip => counts[ip] = (counts[ip] || 0) + 1);
  currentIP = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
  return currentIP;
}

async function updateOnlineUsers() {
  if (skipGuestOnSignOut) return;
  const now = Date.now();
  if (now - lastUpdateTime < 2000) return;
  lastUpdateTime = now;

  try {
    const clientIP = await getClientIP();
    const onlineUsersRef = collection(db, 'onlineUsers');
    let docId, data;

    if (currentUser) {
      // Delete any guest docs with same IP
      const guestQuery = query(
        onlineUsersRef,
        where('ip', '==', clientIP),
        where('isGuest', '==', true)
      );
      const guestSnapshot = await getDocs(guestQuery);
      guestSnapshot.forEach(doc => deleteDoc(doc.ref));

      // Update/create registered user doc
      docId = `user_${currentUser.uid}_${sessionId}`;
      data = {
        uid: currentUser.uid,
        username: currentUser.username,
        email: currentUser.email,
        ip: clientIP,
        lastSeen: serverTimestamp(),
        status: 'online',
        isGuest: false,
        userAgent: navigator.userAgent
      };
      await setDoc(doc(onlineUsersRef, docId), data, { merge: true });

    } else {
      // Only create guest if no registered user exists for this IP
      const regQuery = query(
        onlineUsersRef,
        where('ip', '==', clientIP),
        where('isGuest', '==', false)
      );
      const regSnapshot = await getDocs(regQuery);
      if (regSnapshot.empty) {
        docId = `guest_${clientIP}_${sessionId}`;
        data = {
          ip: clientIP,
          sessionId,
          lastSeen: serverTimestamp(),
          status: 'online',
          isGuest: true,
          userAgent: navigator.userAgent
        };
        await setDoc(doc(onlineUsersRef, docId), data, { merge: true });
      }
    }

    // Count online users
    const oneMinuteAgo = new Date(Date.now() - 60 * 1000);
    const snapshot = await getDocs(query(onlineUsersRef, where('lastSeen', '>', oneMinuteAgo)));
    const registeredUsers = new Set();
    const guestUsers = new Set();
    snapshot.forEach(doc => {
      const d = doc.data();
      if (d.isGuest) guestUsers.add(`${d.ip}_${d.sessionId}`);
      else if (d.uid) registeredUsers.add(`${d.uid}_${doc.id}`);
    });
   const registeredEl = document.getElementById('registeredUsers');
const guestEl = document.getElementById('guestUsers');

if (registeredEl) registeredEl.textContent = registeredUsers.size;
if (guestEl) guestEl.textContent = guestUsers.size;

  } catch (err) {
    console.error("Error updating online users:", err);
  }
}

async function handleUserSignIn() {
  currentIP = null;
  lastUpdateTime = 0;
  try {
    const clientIP = await getClientIP();
    const onlineUsersRef = collection(db, 'onlineUsers');

    // Delete any guest with same IP
    const guestQuery = query(
      onlineUsersRef,
      where('ip', '==', clientIP),
      where('isGuest', '==', true)
    );
    const guestSnapshot = await getDocs(guestQuery);
    guestSnapshot.forEach(doc => deleteDoc(doc.ref));

    setTimeout(updateOnlineUsers, 500);
  } catch (err) {
    console.error("Error during sign-in cleanup:", err);
    setTimeout(updateOnlineUsers, 500);
  }
}

async function handleUserSignOut() {
  try {
    skipGuestOnSignOut = true;
    const clientIP = await getClientIP();
    const onlineUsersRef = collection(db, 'onlineUsers');
    const userDocRef = currentUser
      ? doc(onlineUsersRef, `user_${currentUser.uid}_${sessionId}`)
      : doc(onlineUsersRef, `guest_${clientIP}_${sessionId}`);
    await deleteDoc(userDocRef);

    currentIP = null;
    lastUpdateTime = 0;

    // Delay guest creation only if no registered user exists
    setTimeout(async () => {
      skipGuestOnSignOut = false;
      const regQuery = query(
        onlineUsersRef,
        where('ip', '==', clientIP),
        where('isGuest', '==', false)
      );
      const regSnapshot = await getDocs(regQuery);
      if (regSnapshot.empty) await updateOnlineUsers();
    }, 2000);

  } catch (err) {
    console.error("Error during sign-out:", err);
    skipGuestOnSignOut = false;
  }
}

// Visibility & unload
function setupPageVisibility() {
  document.addEventListener('visibilitychange', async () => {
    const clientIP = await getClientIP();
    const onlineUsersRef = collection(db, 'onlineUsers');
    const docRef = currentUser
      ? doc(onlineUsersRef, `user_${currentUser.uid}_${sessionId}`)
      : doc(onlineUsersRef, `guest_${clientIP}_${sessionId}`);
    const status = document.visibilityState === 'hidden' ? 'away' : 'online';
    await setDoc(docRef, { lastSeen: serverTimestamp(), status }, { merge: true });
  });

  window.addEventListener('beforeunload', async () => {
    const clientIP = await getClientIP();
    const onlineUsersRef = collection(db, 'onlineUsers');
    const docRef = currentUser
      ? doc(onlineUsersRef, `user_${currentUser.uid}_${sessionId}`)
      : doc(onlineUsersRef, `guest_${clientIP}_${sessionId}`);
    await setDoc(docRef, { lastSeen: serverTimestamp(), status: 'offline' }, { merge: true });
  });
}

// Cleanup offline users
async function cleanupOfflineUsers() {
  try {
    const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000);
    const onlineUsersRef = collection(db, 'onlineUsers');
    const snapshot = await getDocs(query(onlineUsersRef, where('lastSeen', '<', twoMinutesAgo)));
    await Promise.all(snapshot.docs.map(doc => deleteDoc(doc.ref)));
  } catch (err) {
    console.error("Error cleaning offline users:", err);
  }
}

// Tracker start
function startOnlineUsersTracker() {
  updateOnlineUsers();
  setInterval(updateOnlineUsers, 5000);
  setInterval(cleanupOfflineUsers, 30000);
  setInterval(() => { currentIP = null }, 60000);
}

// Initialize
startOnlineUsersTracker();
setupPageVisibility();


async function getUserDetailedStats() {
    if (!currentUser) return null;
    
    try {
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'),
                where('author', '==', currentUser.uid)
            )
        );
        
        const stats = {
            totalScripts: snapshot.size,
            totalViews: 0,
            totalDownloads: 0,
            averageViews: 0,
            mostPopularScript: { title: '', views: 0 }
        };
        
        snapshot.forEach(doc => {
            const script = doc.data();
            const views = script.Views || 0;
            const downloads = script.copyCount || 0;
            
            stats.totalViews += views;
            stats.totalDownloads += downloads;
            
            // Track most popular script
            if (views > stats.mostPopularScript.views) {
                stats.mostPopularScript = {
                    title: script.title,
                    views: views
                };
            }
        });
        
        stats.averageViews = snapshot.size > 0 ? Math.round(stats.totalViews / snapshot.size) : 0;
        
        return stats;
    } catch (error) {
        console.error('Error getting detailed stats:', error);
        return null;
    }
}


// Profile Information System - NEW FUNCTION
async function loadProfileInfo() {
    if (!currentUser) return;
    
    try {
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        if (userDoc.exists()) {
            const userData = userDoc.data();
            
            // Load profile information
            document.getElementById('profileDisplayName').value = userData.displayName || currentUser.username;
            document.getElementById('profileBio').value = userData.bio || '';
            document.getElementById('profileWebsite').value = userData.website || '';
        }
    } catch (error) {
        console.error('Error loading profile info:', error);
    }
}

// Save Profile Information - NEW FUNCTION
async function saveProfileInfo() {
    if (!currentUser) return;
    
    const displayName = document.getElementById('profileDisplayName').value.trim();
    const bio = document.getElementById('profileBio').value.trim();
    const website = document.getElementById('profileWebsite').value.trim();
    
    try {
        await setDoc(doc(db, 'users', currentUser.uid), {
            displayName: displayName || currentUser.username,
            bio: bio,
            website: website,
            username: currentUser.username,
            email: currentUser.email,
            lastUpdated: serverTimestamp()
        }, { merge: true });
        
        // Update UI
        document.getElementById('profileUsername').textContent = displayName || currentUser.username;
        document.getElementById('username').textContent = displayName || currentUser.username;
        
        showNotification('Profile updated successfully!');
    } catch (error) {
        console.error('Error saving profile:', error);
        showNotification('Error saving profile', true);
    }
}

        // Enhanced security
function protectSourceCode() {
    document.addEventListener('contextmenu', e => {
     //   if (!isAllowed) {
            e.preventDefault();
            showNotification('Right-click is disabled', true);
        }
);

    const blockedKeys = [
       // { key: 'F12' },
        { ctrl: true, shift: true, key: 'I' },
        { ctrl: true, shift: true, key: 'J' },
        { ctrl: true, key: 'U' },
        { ctrl: true, key: 'S' },
        { meta: true, key: 'U' },           // Cmd+U Mac
        { meta: true, key: 'S' },           // Cmd+S Mac
        { meta: true, shift: true, key: 'I' }, // Cmd+Shift+I Mac
        { meta: true, shift: true, key: 'J' }  // Cmd+Shift+J Mac
    ];

    function isBlocked(e, combo) {
        const ctrlMatch = combo.ctrl ? e.ctrlKey : true;
        const shiftMatch = combo.shift ? e.shiftKey : true;
        const metaMatch = combo.meta ? e.metaKey : true;
        const keyMatch = combo.key ? e.key.toUpperCase() === combo.key.toUpperCase() : true;
        return ctrlMatch && shiftMatch && metaMatch && keyMatch;
    }

    document.addEventListener('keydown', e => {
      //  if (isAllowed) return;
        if (blockedKeys.some(combo => isBlocked(e, combo))) {
            e.preventDefault();
            showNotification('Developer tools are disabled', true);
        }
        if (e.key === 'F1') e.preventDefault(); // Optional: block F1 help
    });

    let devtoolsOpen = false;
    const threshold = 160;

    // DevTools detection via resize
    setInterval(() => {
        const widthThreshold = window.outerWidth - window.innerWidth > threshold;
        const heightThreshold = window.outerHeight - window.innerHeight > threshold;
        if ((widthThreshold || heightThreshold) && !devtoolsOpen) {
            devtoolsOpen = true;
            showNotification('Developer tools are disabled', true);
        } else if (!(widthThreshold || heightThreshold) && devtoolsOpen) {
            devtoolsOpen = false;
        }
    }, 500);

    // DevTools detection via console tampering
    (function() {
        const element = new Image();
        Object.defineProperty(element, 'id', {
            get: function() {
              //  if (!isAllowed) 
               showNotification('Developer tools are disabled', true);
            }
        });
        setInterval(() => console.log(element), 1000);
    })();

    // Debugger timing detection
    setInterval(() => {
       // if (isAllowed) return;
        const start = performance.now();
        debugger;
        const end = performance.now();
        if (end - start > 100) {
            showNotification('Developer tools are disabled', true);
        }
    }, 2000);
}



        // Firebase Authentication
function initAuth() {
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            console.log("User logged in:", user.email, "Email verified:", user.emailVerified);
            currentUser = {
                uid: user.uid,
                email: user.email,
                username: user.displayName || user.email.split('@')[0],
                emailVerified: user.emailVerified
            };
            
            await updateUIForUser();
            loadScripts();
            loadUserStats();
            loadUserFavorites();
            loadProfileInfo();
            updateOnlineUsers();


           // Show verification reminder and button
            const resendBtn = document.getElementById('resendVerificationBtn');
            if (resendBtn) {
                resendBtn.style.display = !user.emailVerified ? 'flex' : 'none';
            }
            
            if (!user.emailVerified) {
                showNotification('Please verify your email address for full access.', false);
            }
        } else {
            console.log("User logged out");
            currentUser = null;
            document.getElementById('authButtons').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('uploadScriptBtn').style.display = 'block';
            document.getElementById('userProfileSection').style.display = 'none';

         //    trackGuestUser();
        }
    }, (error) => {
        console.error("Auth state change error:", error);
        showNotification('Authentication error. Please refresh the page.', true);
    });
}

        // Get Roblox game name from ID
        async function getRobloxGameName(id, timeout = 5000) {
            if (!id || id === "0") return "Universal Script üìå";
            const proxy = "https://api.allorigins.win/raw?url=";
            const fetchWithTimeout = async (url, t = timeout) => Promise.race([
                fetch(url).then(res => res.ok ? res.json() : null),
                new Promise(resolve => setTimeout(() => resolve(null), t))
            ]);
            const placeDetails = await fetchWithTimeout(
                proxy + encodeURIComponent(`https://games.roblox.com/v1/games/multiget-place-details?placeIds=${id}`)
            );
            if (placeDetails && Array.isArray(placeDetails) && placeDetails[0]?.universeId) {
                const universeId = placeDetails[0].universeId;
                const gameData = await fetchWithTimeout(
                    proxy + encodeURIComponent(`https://games.roblox.com/v1/games?universeIds=${universeId}`)
                );
                return gameData?.data?.[0]?.name || placeDetails[0]?.name || "Roblox Game";
            }
            const placeToUniverse = await fetchWithTimeout(
                proxy + encodeURIComponent(`https://apis.roblox.com/universes/v1/places/${id}/universe`)
            );
            const universeId = placeToUniverse?.universeId || id;
            const gameInfo = await fetchWithTimeout(
                proxy + encodeURIComponent(`https://games.roblox.com/v1/games?universeIds=${universeId}`)
            );
            return gameInfo?.data?.[0]?.name || "Roblox Game";
        }

        function setLoading(button, isLoading) {
    if (isLoading) {
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    } else {
        button.disabled = false;
        button.innerHTML = 'Login';
    }
}

// RecentUploads
async function loadRecentUploads() {
    if (!currentUser) return;
    
    try {
        // Get all user scripts and sort them manually
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'),
                where('author', '==', currentUser.uid)
            )
        );
        
        const recentScriptsGrid = document.getElementById('recentScriptsGrid');
        if (!recentScriptsGrid) return;
        
        recentScriptsGrid.innerHTML = '';
        
        if (!snapshot.empty) {
            document.getElementById('recentUploads').style.display = 'block';
            
            // Convert to array and sort by date manually
            const scripts = [];
            snapshot.forEach(doc => {
                scripts.push({ id: doc.id, ...doc.data() });
            });
            
            // Sort by createdAt date (newest first)
            scripts.sort((a, b) => {
                const dateA = a.createdAt?.toDate() || new Date(0);
                const dateB = b.createdAt?.toDate() || new Date(0);
                return dateB - dateA;
            });
            
            // Take only the 5 most recent
            const recentScripts = scripts.slice(0, 5);
            
            recentScripts.forEach(script => {
                const card = document.createElement('div');
                card.className = 'recent-script-card';
                card.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px; font-size: 0.9rem;">${script.title}</div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary);">
                        <div>Views: ${script.Views || 0}</div>
                        <div>${formatDate(script.createdAt?.toDate())}</div>
                    </div>
                `;
                card.addEventListener('click', () => viewScriptDetails(script.id));
                recentScriptsGrid.appendChild(card);
            });
        } else {
            document.getElementById('recentUploads').style.display = 'none';
        }
    } catch (error) {
        console.error('Error loading recent uploads:', error);
        document.getElementById('recentUploads').style.display = 'none';
    }
}

// Fixed update user stats - this one should work fine
async function updateUploadStats() {
    if (!currentUser) return;
    
    try {
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'),
                where('author', '==', currentUser.uid)
            )
        );
        
        let totalViews = 0;
        snapshot.forEach(doc => {
            totalViews += doc.data().Views || 0;
        });
        
        const userScriptCount = document.getElementById('userScriptCount');
        const totalViewsElement = document.getElementById('totalViews');
        
        if (userScriptCount) userScriptCount.textContent = snapshot.size;
        if (totalViewsElement) totalViewsElement.textContent = totalViews;
        
    } catch (error) {
        console.error('Error updating upload stats:', error);
    }
}

///////////////////////////////////////////////////////////////////////////



//Trending 
async function loadTrendingScripts() {
    try {
        const trendingScriptsGrid = document.getElementById('trendingScriptsGrid');
        trendingScriptsGrid.innerHTML = '<div class="loader" style="display: block;"></div>';
        
        // Get scripts sorted by views (most popular first)
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'), 
                orderBy('Views', 'desc'),
                limit(12)
            )
        );
        
        trendingScriptsGrid.innerHTML = '';
        
        if (snapshot.empty) {
            trendingScriptsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray);">No trending scripts found.</p>';
            return;
        }
        
        snapshot.forEach(doc => {
            const script = { id: doc.id, ...doc.data() };
            displayTrendingScript(script);
        });
        
    } catch (error) {
        console.error('Error loading trending scripts:', error);
        document.getElementById('trendingScriptsGrid').innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--danger);">Error loading trending scripts.</p>';
    }
}

function displayTrendingScript(script) {
    const trendingScriptsGrid = document.getElementById('trendingScriptsGrid');
    const scriptCard = document.createElement('div');
    scriptCard.className = 'script-card';
    scriptCard.id = `trending-script-${script.id}`;
    
    const formattedDate = formatDate(script.createdAt?.toDate() || new Date());
    const imageSrc = script.imageBase64 || "https://cdn-icons-png.flaticon.com/512/2721/2721620.png";
    
    // Add trending badge
    const isTrending = (script.Views || 0) > 100; // Example condition
    
    scriptCard.innerHTML = `
        <div class="script-image">
            ${script.patched ? '<div class="patched-overlay">PATCHED</div>' : ''}
            ${script.requiresKey ? '<div class="key-icon"><i class="fas fa-key"></i></div>' : ''}
            ${isTrending ? '<div class="trending-badge"><i class="fas fa-fire"></i> TRENDING</div>' : ''}
            <img src="${imageSrc}" alt="Script Icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2721/2721620.png'">
            <div class="script-date-overlay">
                <i class="fas fa-calendar"></i> ${formattedDate}
            </div>
        </div>
        <div class="script-content">
            <div class="script-game" id="trending-game-name-${script.id}">
                <i class="fas fa-spinner fa-spin"></i> Loading game...
            </div>
            <h3 class="script-title">${script.title}</h3>
            <div class="script-meta">
                <span><i class="fas fa-eye"></i> ${formatNumber(script.Views || 0)} views</span>
                <span><i class="fas fa-download"></i> ${formatNumber(script.copyCount || 0)}</span>
            </div>
            <div class="script-actions">
                <button class="btn btn-primary" onclick="viewScriptDetails('${script.id}')">View Script</button>
                ${currentUser && currentUser.uid === script.author ? 
                    `<div style="display: flex; gap: 5px;">
                        <button class="btn edit-btn" onclick="editScript('${script.id}')"><i class="fas fa-edit"></i></button>
                        <button class="btn delete-btn" onclick="deleteScript('${script.id}')"><i class="fas fa-trash"></i></button>
                    </div>` : 
                    `<button class="btn btn-outline" onclick="copyScript('${script.id}')"><i class="fas fa-copy"></i></button>`
                }
            </div>
        </div>
    `;
    
    trendingScriptsGrid.appendChild(scriptCard);
    updateTrendingGameName(script.id, script.gameId);
}

async function updateTrendingGameName(scriptId, gameId) {
    try {
        const gameName = await getRobloxGameName(gameId);
        const gameElement = document.getElementById(`trending-game-name-${scriptId}`);
        if (gameElement) {
            gameElement.innerHTML = `<i class="fas fa-gamepad"></i> ${gameName}`;
        }
    } catch (error) {
        console.error(`Error updating game name for trending script ${scriptId}:`, error);
        const gameElement = document.getElementById(`trending-game-name-${scriptId}`);
        if (gameElement) {
            gameElement.innerHTML = `<i class="fas fa-gamepad"></i> Roblox Game`;
        }
    }
}



     // Load scripts from Firebase
async function loadScripts() {
    const scriptsGrid = document.getElementById('scriptsGrid');
    scriptsGrid.innerHTML = '<div class="loader" style="display: block;"></div>';
    
    try {
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'), 
                orderBy('createdAt', 'desc')
            )
        );
        
        scriptsGrid.innerHTML = '';
        
        if (snapshot.empty) {
            scriptsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray);">No scripts found. Be the first to upload one!</p>';
            return;
        }
        
        snapshot.forEach(doc => {
            const script = { id: doc.id, ...doc.data() };
            displayScript(script);
        });
    } catch (error) {
        console.error('Error loading scripts:', error);
        scriptsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--danger);">Error loading scripts. Please refresh the page.</p>';
        showNotification('Error loading scripts', true);
    }
}



        function displayScript(script) {
            const scriptsGrid = document.getElementById('scriptsGrid');
            const scriptCard = document.createElement('div');
            scriptCard.className = 'script-card';
            scriptCard.id = `script-${script.id}`;
            
            const formattedDate = formatDate(script.createdAt?.toDate() || new Date());
               let imageSrc = "https://cdn-icons-png.flaticon.com/512/2721/2721620.png"; // Default fallback
    
    if (script.imageBase64) {
        imageSrc = script.imageBase64; // Use Base64 data URL directly
    } else if (script.imageBase64) {
        imageSrc = script.imageBase64; // Fallback to old imageUrl for existing scripts
    }
            scriptCard.innerHTML = `
        <div class="script-image">
            ${script.patched ? '<div class="patched-overlay">PATCHED</div>' : ''}
            ${script.requiresKey ? '<div class="key-icon"><i class="fas fa-key"></i></div>' : ''}
            <img src="${imageSrc}" alt="Script Icon" onerror="this.onerror=null; this.src='https://cdn-icons-png.flaticon.com/512/2721/2721620.png'">
            <div class="script-date-overlay">
                <i class="fas fa-calendar"></i> ${formattedDate}
            </div>
                </div>
                <div class="script-content">
                    <div class="script-game" id="game-name-${script.id}">
                        <i class="fas fa-spinner fa-spin"></i> Loading game...
                    </div>
                    <h3 class="script-title">${script.title}</h3>
                  <div class="script-meta">
    <div class="meta-left">
        <span><i class="fas fa-eye"></i> ${formatNumber(script.Views || 0)} views</span>
    </div>
    ${currentUser ? `
        <button 
            class="favorite-btn ${userFavorites.has(script.id) ? 'active' : ''}" 
            data-script-id="${script.id}" 
            title="Add to favorites"
        >
            <i class="fas fa-heart"></i>
        </button>
    ` : ''}
</div>

                    <div class="script-actions">
                        <button class="btn btn-primary" onclick="viewScriptDetails('${script.id}')">View Script</button>
                        ${currentUser && currentUser.uid === script.author ? 
                            `<div style="display: flex; gap: 5px;">
                                <button class="btn edit-btn" onclick="editScript('${script.id}')"><i class="fas fa-edit"></i></button>
                                <button class="btn delete-btn" onclick="deleteScript('${script.id}')"><i class="fas fa-trash"></i></button>
                            </div>` : 
                            `<button class="btn btn-outline" onclick="copyScript('${script.id}')"><i class="fas fa-copy"></i></button>`
                        }
                    </div>
                </div>
            `;
            
            scriptsGrid.appendChild(scriptCard);
            
            // Fetch and update the game name
            updateGameName(script.id, script.gameId);
            
            // Add favorite button event listener
            if (currentUser) {
                const favoriteBtn = scriptCard.querySelector('.favorite-btn');
                if (favoriteBtn) {
                    favoriteBtn.addEventListener('click', function() {
                        toggleFavorite(script.id);
                    });
                }
            }
        }

        // Function to update game name after fetching from Roblox API
        async function updateGameName(scriptId, gameId) {
            try {
                const gameName = await getRobloxGameName(gameId);
                const gameElement = document.getElementById(`game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> ${gameName}`;
                }
            } catch (error) {
                console.error(`Error updating game name for script ${scriptId}:`, error);
                const gameElement = document.getElementById(`game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> Roblox Game`;
                }
            }
        }

        // View script details
async function viewScriptDetails(scriptId) {
     await debugScriptAccess(scriptId); // Temporary debug
    try {
        const docRef = doc(db, 'scripts', scriptId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
            showNotification('Script not found', true);
            return;
        }

        const script = { id: docSnap.id, ...docSnap.data() };
        
        // Check if user has permission to read this script
        if (!script.author && !script.public) {
            showNotification('You do not have permission to view this script', true);
            return;
        }

        showScriptDetails(script);
        
        // Increment view count with error handling
        try {
            await updateDoc(docRef, {
                Views: (script.Views || 0) + 1
            });
        } catch (updateError) {
            console.warn('Could not update view count:', updateError);
            // Continue showing script even if view count update fails
        }
        
    } catch (error) {
        console.error('Error loading script details:', error);
        
        if (error.code === 'permission-denied') {
            showNotification('Permission denied: You cannot view this script', true);
        } else if (error.code === 'not-found') {
            showNotification('Script not found', true);
        } else {
            showNotification('Error loading script details: ' + error.message, true);
        }
    }
}



      function showScriptDetails(script) {
    try {
        // Validate required fields
        if (!script || !script.title || !script.code) {
            showNotification('Invalid script data', true);
            return;
        }

        document.getElementById('detailsTitle').textContent = script.title || 'Untitled Script';
        document.getElementById('detailsScriptTitle').textContent = script.title || 'Untitled Script';
        document.getElementById('detailsDownloads').textContent = formatNumber(script.Views || 0);
        document.getElementById('detailsDate').textContent = formatDate(script.createdAt?.toDate() || new Date());
        document.getElementById('detailsCode').textContent = script.code || '// No code available';
        document.getElementById('detailsAuthor').textContent = script.authorName || "Unknown";
        
        // Set game button URL safely
        const gameBtn = document.getElementById('gameBtn');
        if (script.gameId && script.gameId !== "0") {
            gameBtn.href = `https://www.roblox.com/games/${script.gameId}`;
            gameBtn.style.display = 'flex';
        } else {
            gameBtn.style.display = 'none';
        }

        // Set image with fallback
        const detailsImage = document.getElementById('detailsImage');
        if (script.imageBase64) {
            detailsImage.src = script.imageBase64;
        } else {
            detailsImage.src = "https://cdn-icons-png.flaticon.com/512/2721/2721620.png";
        }
        detailsImage.onerror = function() {
            this.src = "https://cdn-icons-png.flaticon.com/512/2721/2721620.png";
        };
        
        // Show/hide patched overlay
        const patchedOverlay = document.getElementById('patchedOverlay');
        if (script.patched) {
            patchedOverlay.style.display = 'flex';
            const scriptImage = document.querySelector('.script-details-image');
            if (scriptImage) {
                scriptImage.appendChild(patchedOverlay);
            }
        } else {
            patchedOverlay.style.display = 'none';
        }

         // Setup action buttons
            const viewRawBtn = document.getElementById('viewRawBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // Create blob for download and raw view
const scriptId = script.id;
const url = `/scripts/${scriptId}.lua`;
viewRawBtn.href = url;
viewRawBtn.target = "_blank";
downloadBtn.href = url;
downloadBtn.download = `${(script.title || scriptId).replace(/\s+/g, '_')}.lua`;

   document.getElementById('scriptDetailsModal').style.display = 'flex';

        

        // Apply syntax highlighting
        setTimeout(() => {
            const codeElement = document.getElementById('detailsCode');
            if (codeElement) {
                hljs.highlightElement(codeElement);
            }
        }, 100);
        
        
        // Clean up URL when modal closes
        const modal = document.getElementById('scriptDetailsModal');
        const closeHandler = function() {
            URL.revokeObjectURL(url);
        };
        
        // Remove existing listeners and add new one
        modal.removeEventListener('click', closeHandler);
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeHandler();
            }
        });
        
    } catch (error) {
        console.error('Error displaying script details:', error);
        showNotification('Error displaying script details', true);
    }
}


// Add this temporary debug function
async function debugScriptAccess(scriptId) {
    try {
        console.log('Attempting to access script:', scriptId);
        const docRef = doc(db, 'scripts', scriptId);
        const docSnap = await getDoc(docRef);
        
        console.log('Document exists:', docSnap.exists());
        if (docSnap.exists()) {
            const data = docSnap.data();
            console.log('Script data:', {
                id: docSnap.id,
                title: data.title,
                author: data.author,
                hasAuthor: !!data.author,
                currentUser: currentUser ? currentUser.uid : 'no user'
            });
        }
    } catch (error) {
        console.error('Debug access error:', error);
        console.error('Error code:', error.code);
        console.error('Error message:', error.message);
    }
}


        function closeScriptDetails() {
            document.getElementById('scriptDetailsModal').style.display = 'none';
        }

        // Edit script functionality
async function editScript(scriptId) {
    try {
        const docSnap = await getDoc(doc(db, 'scripts', scriptId));
        if (docSnap.exists()) {
            const script = { id: docSnap.id, ...docSnap.data() };
            currentEditingScript = script;
            
            document.getElementById('editScriptId').value = script.id;
            document.getElementById('editScriptTitle').value = script.title;
            document.getElementById('editGameId').value = script.gameId || '';
            document.getElementById('editScriptCode').value = script.code;
            document.getElementById('editIsPatched').checked = script.patched || false;
            document.getElementById('editKeySystemToggle').checked = script.requiresKey || false;
            
            // REMOVED THE PROBLEMATIC LINE:
            // document.getElementById('editMarkAsVerified').checked = script.verified || false;

            // Show current image if exists
             if (script.imageBase64) {
                document.getElementById('editImagePreview').src = script.imageBase64;
                document.getElementById('editImagePreviewContainer').style.display = 'block';
            } else if (script.imageBase64) {
                // Fallback for old scripts with imageUrl
                document.getElementById('editImagePreview').src = script.imageBase64;
                document.getElementById('editImagePreviewContainer').style.display = 'block';
            } else {
                document.getElementById('editImagePreviewContainer').style.display = 'none';
            }

            document.getElementById('editNewImagePreviewContainer').style.display = 'none';
            document.getElementById('editFileName').textContent = 'No file chosen';

            // Show current game name
            if (script.game && script.game !== "Roblox Game") {
                document.getElementById('editGameNameDisplay').textContent = `Current: ${script.game}`;
            } else {
                document.getElementById('editGameNameDisplay').textContent = '';
            }
            
            document.getElementById('editModal').style.display = 'flex';
        }
    } catch (error) {
        console.error('Error loading script for edit:', error);
        showNotification('Error loading script: ' + error.message, true);
    }
}


        // Delete script functionality
      async function deleteScript(scriptId) {
    if (!confirm('Are you sure you want to delete this script? This action cannot be undone.')) {
        return;
    }
    
    try {
        await deleteDoc(doc(db, 'scripts', scriptId));
        showNotification('Script deleted successfully');
        loadScripts();
        loadUserStats();
    } catch (error) {
        console.error('Error deleting script:', error);
        showNotification('Error deleting script', true);
    }
}

        async function copyScriptFromDetails() {
            const code = document.getElementById('detailsCode').textContent;
            try {
                await navigator.clipboard.writeText(code);
                showNotification('Script copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy: ', err);
                showNotification('Failed to copy script', true);
            }
        }

        
   async function copyScript(scriptId) {
        await debugCopyScript(scriptId); // Debug first
    try {
        const docRef = doc(db, 'scripts', scriptId);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists()) {
            showNotification('Script not found', true);
            return;
        }

        const script = docSnap.data();
        
        // Copy to clipboard
        await navigator.clipboard.writeText(script.code || '');
        showNotification('Script copied to clipboard!');

        // Update copyCount - FIXED: Use specific field update
        await updateDoc(docRef, {
            copyCount: (script.copyCount || 0) + 1
        });

        // Update the UI immediately
        const scriptCard = document.getElementById(`script-${scriptId}`);
        if (scriptCard) {
            const downloadSpan = scriptCard.querySelector('.script-meta span:nth-child(2)');
            if (downloadSpan) {
                const newCount = (script.copyCount || 0) + 1;
                downloadSpan.innerHTML = `<i class="fas fa-download"></i> ${formatNumber(newCount)}`;
            }
        }

    } catch (error) {
        console.error('Error copying script:', error);
        
        if (error.code === 'permission-denied') {
            console.log('Permission denied for copyCount update');
            // Still show success for copy, just log the update error
        } else {
            showNotification('Error copying script', true);
        }
    }
}

async function debugCopyScript(scriptId) {
    try {
        const docRef = doc(db, 'scripts', scriptId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
            console.log('Script not found');
            return;
        }

        const script = docSnap.data();
        console.log('Current script data:', {
            id: scriptId,
            copyCount: script.copyCount,
            author: script.author,
            currentUser: currentUser ? currentUser.uid : 'no user'
        });

        // Test the update
        const newCopyCount = (script.copyCount || 0) + 1;
        console.log('Attempting to update copyCount to:', newCopyCount);
        
        await updateDoc(docRef, {
            copyCount: newCopyCount
        });
        
        console.log('Update successful!');
        
    } catch (error) {
        console.error('Debug update error:', error);
        console.error('Error code:', error.code);
        console.error('Error message:', error.message);
    }
}

        // Load user stats
async function loadUserStats() {
    if (!currentUser) return;
    
    try {
        // Get user's scripts
        const snapshot = await getDocs(
            query(
                collection(db, 'scripts'),
                where('author', '==', currentUser.uid)
            )
        );
        
        let totalViews = 0;
        let totalDownloads = 0;

        snapshot.forEach(doc => {
            const script = doc.data();
            totalViews += script.Views || 0;
             totalDownloads += script.copyCount || 0;
            
        });
        
        
        // Update stats
        document.getElementById('statScripts').textContent = snapshot.size;
        document.getElementById('statViews').textContent = formatNumber(totalViews);
        document.getElementById('statDownloads').textContent = formatNumber(totalDownloads);
        

        // Calculate days since joined
       const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
if (userDoc.exists()) {
    const userData = userDoc.data();
    let joinDate;
    if (userData.joinDate && userData.joinDate.toDate) {
        joinDate = userData.joinDate.toDate();
    } else {
        joinDate = new Date();
    }
    const now = new Date();
    const timeDiff = now.getTime() - joinDate.getTime();
    const daysJoined = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
    document.getElementById('statJoined').textContent = Math.max(1, daysJoined);
} else {
    document.getElementById('statJoined').textContent = '1';
}

        // Load user's scripts
        const userScriptsGrid = document.getElementById('userScriptsGrid');
        userScriptsGrid.innerHTML = '';
        
        if (snapshot.empty) {
            userScriptsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray);">You haven\'t uploaded any scripts yet.</p>';
            return;
        }
        
        snapshot.forEach(doc => {
            const script = { id: doc.id, ...doc.data() };
            displayUserScript(script);
        });
        
    } catch (error) {
        console.error('Error loading user stats:', error);
    }
}


        function displayUserScript(script) {
            const userScriptsGrid = document.getElementById('userScriptsGrid');
            const scriptCard = document.createElement('div');
            scriptCard.className = 'script-card';
            scriptCard.id = `user-script-${script.id}`;
            
            const formattedDate = formatDate(script.createdAt?.toDate() || new Date());
            const imageSrc = script.imageBase64 || "https://cdn-icons-png.flaticon.com/512/2721/2721620.png";
            
scriptCard.innerHTML = `
    <div class="script-image">
        ${script.patched ? '<div class="patched-overlay">PATCHED</div>' : ''}
        ${script.requiresKey ? '<div class="key-icon"><i class="fas fa-key"></i></div>' : ''}
        <img src="${imageSrc}" alt="Script Icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2721/2721620.png'">
        <div class="script-date-overlay">
            <i class="fas fa-calendar"></i> ${formattedDate}
        </div>
    </div>
    <div class="script-content">
        <div class="script-game" id="user-game-name-${script.id}">
            <i class="fas fa-spinner fa-spin"></i> Loading game...
        </div>
        <h3 class="script-title">${script.title}</h3>
        <div class="script-meta">
            <span><i class="fas fa-eye"></i> ${formatNumber(script.Views || 0)} views</span>  <!-- Changed icon from download to eye -->
        </div>
        <div class="script-actions">
            <button class="btn btn-primary" onclick="viewScriptDetails('${script.id}')">View Script</button>
            <div style="display: flex; gap: 5px;">
                <button class="btn edit-btn" onclick="editScript('${script.id}')"><i class="fas fa-edit"></i></button>
                <button class="btn delete-btn" onclick="deleteScript('${script.id}')"><i class="fas fa-trash"></i></button>
            </div>
        </div>
    </div>
`;
            
            userScriptsGrid.appendChild(scriptCard);
            
            // Fetch and update the game name
            updateUserGameName(script.id, script.gameId);
        }

        async function updateUserGameName(scriptId, gameId) {
            try {
                const gameName = await getRobloxGameName(gameId);
                const gameElement = document.getElementById(`user-game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> ${gameName}`;
                }
            } catch (error) {
                console.error(`Error updating game name for user script ${scriptId}:`, error);
                const gameElement = document.getElementById(`user-game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> Roblox Game`;
                }
            }
        }

      // Favorite system - Fixed error handling
async function loadUserFavorites() {
    if (!currentUser) return;
    
    try {
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid)); // ‚Üê Fixed
        if (userDoc.exists() && userDoc.data().favorites) {
            userFavorites = new Set(userDoc.data().favorites);
        }
    } catch (error) {
        console.error('Error loading user favorites:', error);
    }
}

async function toggleFavorite(scriptId) {
    if (!currentUser) {
        showNotification('Please log in to favorite scripts', true);
        return;
    }
    
    try {
        if (userFavorites.has(scriptId)) {
            userFavorites.delete(scriptId);
        } else {
            userFavorites.add(scriptId);
        }
        
        // Update favorites in Firestore
        await setDoc(doc(db, 'users', currentUser.uid), {
            favorites: Array.from(userFavorites),
            username: currentUser.username,
            email: currentUser.email,
         //   joinDate: serverTimestamp()
        }, { merge: true });
        
        // Update UI
        const favoriteBtn = document.querySelector(`.favorite-btn[data-script-id="${scriptId}"]`);
        if (favoriteBtn) {
            favoriteBtn.classList.toggle('active');
        }
        
        showNotification(userFavorites.has(scriptId) ? 'Added to favorites' : 'Removed from favorites');
        
        // If on favorites tab, reload favorites
        if (document.querySelector('.profile-tab.active').dataset.tab === 'favorites') {
            loadFavoriteScripts();
        }
    } catch (error) {
        console.error('Error toggling favorite:', error);
        showNotification('Error updating favorites', true);
    }
}

       async function loadFavoriteScripts() {
    if (!currentUser || userFavorites.size === 0) {
        document.getElementById('favoriteScriptsGrid').innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray);">No favorite scripts yet.</p>';
        return;
    }
    
    try {
        const favoriteScriptsGrid = document.getElementById('favoriteScriptsGrid');
        favoriteScriptsGrid.innerHTML = '<div class="loader" style="display: block;"></div>';
        
        const favoriteIds = Array.from(userFavorites);
        const favoriteScripts = [];
        
        // Get each favorite script
        for (const scriptId of favoriteIds) {
            const docSnap = await getDoc(doc(db, 'scripts', scriptId)); // ‚Üê Fixed
            if (docSnap.exists()) {
                favoriteScripts.push({ id: docSnap.id, ...docSnap.data() });
            }
        }
        
        favoriteScriptsGrid.innerHTML = '';
        
        if (favoriteScripts.length === 0) {
            favoriteScriptsGrid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--gray);">No favorite scripts found.</p>';
            return;
        }
        
        favoriteScripts.forEach(script => {
            displayFavoriteScript(script);
        });
    } catch (error) {
        console.error('Error loading favorite scripts:', error);
        document.getElementById('favoriteScriptsGrid').innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--danger);">Error loading favorite scripts.</p>';
    }
}

        function displayFavoriteScript(script) {
            const favoriteScriptsGrid = document.getElementById('favoriteScriptsGrid');
            const scriptCard = document.createElement('div');
            scriptCard.className = 'script-card';
            scriptCard.id = `favorite-script-${script.id}`;
            
            const formattedDate = formatDate(script.createdAt?.toDate() || new Date());
            const imageSrc = script.imageBase64 || "https://cdn-icons-png.flaticon.com/512/2721/2721620.png";
            
scriptCard.innerHTML = `
    <div class="script-image">
        ${script.patched ? '<div class="patched-overlay">PATCHED</div>' : ''}
        ${script.requiresKey ? '<div class="key-icon"><i class="fas fa-key"></i></div>' : ''}
        <img src="${imageSrc}" alt="Script Icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2721/2721620.png'">
        <div class="script-date-overlay">
            <i class="fas fa-calendar"></i> ${formattedDate}
        </div>
    </div>
    <div class="script-content">
        <div class="script-game" id="favorite-game-name-${script.id}">
            <i class="fas fa-spinner fa-spin"></i> Loading game...
        </div>
        <h3 class="script-title">${script.title}</h3>
        <div class="script-meta">
            <span><i class="fas fa-eye"></i> ${formatNumber(script.Views || 0)} views</span>  <!-- Changed icon from download to eye -->
            <button class="favorite-btn active" data-script-id="${script.id}">
                <i class="fas fa-heart"></i>
            </button>
        </div>
        <div class="script-actions">
            <button class="btn btn-primary" onclick="viewScriptDetails('${script.id}')">View Script</button>
            <button class="btn btn-outline" onclick="copyScript('${script.id}')"><i class="fas fa-copy"></i></button>
        </div>
    </div>
`;
            
            favoriteScriptsGrid.appendChild(scriptCard);
            
            // Fetch and update the game name
            updateFavoriteGameName(script.id, script.gameId);
            
            // Add favorite button event listener
            const favoriteBtn = scriptCard.querySelector('.favorite-btn');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', function() {
                    toggleFavorite(script.id);
                });
            }
        }

        async function updateFavoriteGameName(scriptId, gameId) {
            try {
                const gameName = await getRobloxGameName(gameId);
                const gameElement = document.getElementById(`favorite-game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> ${gameName}`;
                }
            } catch (error) {
                console.error(`Error updating game name for favorite script ${scriptId}:`, error);
                const gameElement = document.getElementById(`favorite-game-name-${scriptId}`);
                if (gameElement) {
                    gameElement.innerHTML = `<i class="fas fa-gamepad"></i> Roblox Game`;
                }
            }
        }

        // Utility functions
        function formatDate(date, full = false) {
            const now = new Date();
            let diff = Math.floor((now - date) / 1000);
            if (diff < 5) return 'just now';
            if (diff < 60) return `${diff} second${diff !== 1 ? 's' : ''} ago`;
            if (diff < 3600) {
                const mins = Math.floor(diff / 60);
                return `${mins} minute${mins !== 1 ? 's' : ''} ago`;
            }
            if (diff < 86400) {
                const hours = Math.floor(diff / 3600);
                return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
            }
            const days = Math.floor(diff / 86400);
            if (days === 1) return 'yesterday';
            if (!full) {
                if (days < 7) return `${days} day${days !== 1 ? 's' : ''} ago`;
                if (days < 30) return `${Math.floor(days / 7)} week${Math.floor(days / 7) !== 1 ? 's' : ''} ago`;
                if (days < 365) return `${Math.floor(days / 30)} month${Math.floor(days / 30) !== 1 ? 's' : ''} ago`;
                return `${Math.floor(days / 365)} year${Math.floor(days / 365) !== 1 ? 's' : ''} ago`;
            } else {
                let rem = diff;
                const years = Math.floor(rem / 31536000); rem -= years * 31536000;
                const months = Math.floor(rem / 2592000); rem -= months * 2592000;
                const weeks = Math.floor(rem / 604800); rem -= weeks * 604800;
                const daysLeft = Math.floor(rem / 86400);
                const parts = [];
                if (years) parts.push(`${years} year${years !== 1 ? 's' : ''}`);
                if (months) parts.push(`${months} month${months !== 1 ? 's' : ''}`);
                if (weeks) parts.push(`${weeks} week${weeks !== 1 ? 's' : ''}`);
                if (daysLeft) parts.push(`${daysLeft} day${daysLeft !== 1 ? 's' : ''}`);
                return parts.join(' ') + ' ago';
            }
        }

        function formatNumber(num, decimals = 1) {
            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
            if (num < 1000) return num.toString();
            let e = Math.floor(Math.log10(num) / 3);
            if (e >= suffixes.length) e = suffixes.length - 1;
            let val = (num / Math.pow(1000, e)).toFixed(decimals).replace(/\.0+$/, '');
            return val + suffixes[e];
        }


        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification ${isError ? 'error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        async function updateUIForUser() {
    document.getElementById('authButtons').style.display = 'none';
    document.getElementById('userInfo').style.display = 'flex';
    document.getElementById('uploadSection').style.display = 'block';
    document.getElementById('uploadScriptBtn').style.display = 'none';
    document.getElementById('userProfileSection').style.display = 'block';
    document.getElementById('username').textContent = currentUser.username;
    
    const userAvatarText = document.getElementById('userAvatarText');
    const userAvatarImg = document.getElementById('userAvatarImg');
    const profileAvatarText = document.getElementById('profileAvatarText');
    const profileAvatarImg = document.getElementById('profileAvatarImg');
    const mobileUserAvatarText = document.getElementById('mobileUserAvatarText');
    const mobileUserAvatarImg = document.getElementById('mobileUserAvatarImg');
    
    try {
        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
        if (userDoc.exists() && userDoc.data().profilePicture) {
            userAvatarImg.src = userDoc.data().profilePicture;
            userAvatarImg.style.display = 'block';
            userAvatarText.style.display = 'none';
            
            profileAvatarImg.src = userDoc.data().profilePicture;
            profileAvatarImg.style.display = 'block';
            profileAvatarText.style.display = 'none';
            
            mobileUserAvatarImg.src = userDoc.data().profilePicture;
            mobileUserAvatarImg.style.display = 'block';
            mobileUserAvatarText.style.display = 'none';
        } else {
            userAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
            userAvatarText.style.display = 'block';
            userAvatarImg.style.display = 'none';
            
            profileAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
            profileAvatarText.style.display = 'block';
            profileAvatarImg.style.display = 'none';
            
            mobileUserAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
            mobileUserAvatarText.style.display = 'block';
            mobileUserAvatarImg.style.display = 'none';
        }
    } catch (error) {
        console.error('Error loading profile picture:', error);
        userAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
        userAvatarText.style.display = 'block';
        userAvatarImg.style.display = 'none';
        
        profileAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
        profileAvatarText.style.display = 'block';
        profileAvatarImg.style.display = 'none';
        
        mobileUserAvatarText.textContent = currentUser.username.charAt(0).toUpperCase();
        mobileUserAvatarText.style.display = 'block';
        mobileUserAvatarImg.style.display = 'none';
    }
    
    document.getElementById('profileUsername').textContent = currentUser.username;
    document.getElementById('profileEmail').textContent = currentUser.email;
    document.getElementById('mobileUsername').textContent = currentUser.username;
    document.getElementById('mobileUserInfo').style.display = 'flex';
    document.getElementById('mobileAuthButtons').style.display = 'none';

     await updateUploadStats();
    await loadRecentUploads();


}


        // Initialize particles.js
        function initParticles() {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#8b5cf6" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#8b5cf6",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    }
                }
            });
        }

class ThemeManager {
    constructor() {
        this.currentTheme = 'dark'; // default theme
        this.init();
    }

    init() {
        this.loadTheme();
        this.bindEvents();
        this.applyTheme(this.currentTheme);
    }

    bindEvents() {
        // Theme toggle button
        document.getElementById('themeToggle')?.addEventListener('click', (e) => {
            e.stopPropagation();
            this.toggleDropdown();
        });

        // Theme options
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', () => {
                const theme = option.dataset.theme;
                this.setTheme(theme);
                this.hideDropdown();
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            this.hideDropdown();
        });
    }

updateHighlightJS(themeName) {
    const old = document.getElementById('highlight-theme');
    if (old) old.remove();

     const themeMap = {
    light: 'github',
    dark: 'dracula',
    blue: 'tokyo-night-dark',
    green: 'androidstudio',
    purple: 'an-old-hope',
    red: 'monokai',
    orange: 'sunburst',
    pink: 'night-owl',
    teal: 'nord',
    gray: 'stackoverflow-dark',
    cyber: 'gradient-dark'
  };

    const theme = themeMap[themeName] || 'atom-one-dark';
    const link = document.createElement('link');
    link.id = 'highlight-theme';
    link.rel = 'stylesheet';
    link.href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/${theme}.min.css`;
    link.onerror = () => console.warn('Highlight.js theme failed to load:', theme);
    document.head.appendChild(link);

    const refresh = () => document.querySelectorAll('pre code').forEach(hljs.highlightElement);
    if (link.sheet) refresh();
    else link.onload = refresh;
}



    toggleDropdown() {
        const dropdown = document.getElementById('themeDropdown');
        dropdown?.classList.toggle('show');
    }

    hideDropdown() {
        const dropdown = document.getElementById('themeDropdown');
        dropdown?.classList.remove('show');
    }

    setTheme(themeName) {
        this.currentTheme = themeName;
        this.applyTheme(themeName);
        this.saveTheme(themeName);
        this.updateHighlightJS(themeName)
    }

    applyTheme(themeName) {
        document.documentElement.setAttribute('data-theme', themeName);
        
        // Update particles for different themes if needed
        this.updateParticles(themeName);
        
        // Dispatch event for other components to react to theme changes
        window.dispatchEvent(new CustomEvent('themeChanged', { detail: themeName }));
    }

    updateParticles(themeName) {
        // You can customize particles based on theme
        const primaryColor = getComputedStyle(document.documentElement)
            .getPropertyValue('--primary')
            .trim();
            
        // If you want to update particles.js colors based on theme
        if (window.particlesJS && typeof window.updateParticlesColor === 'function') {
            window.updateParticlesColor(primaryColor);
        }
    }

    saveTheme(themeName) {
        localStorage.setItem('scriptHubTheme', themeName);
    }

    loadTheme() {
        const savedTheme = localStorage.getItem('scriptHubTheme');
        if (savedTheme) {
            this.currentTheme = savedTheme;
        }
    }

    // Method to get current theme
    getCurrentTheme() {
        return this.currentTheme;
    }

    // Method to cycle through themes
    cycleTheme() {
      const themes = ['dark', 'light', 'blue', 'green', 'purple', 'red', 'orange', 'pink', 'teal', 'gray', 'cyber'];
        const currentIndex = themes.indexOf(this.currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        this.setTheme(themes[nextIndex]);
    }
}

let themeManager;

// Initialize the application
function initApplication() {
    // Apply source code protection
    protectSourceCode();
    
    // Initialize particles
    initParticles();
    
    // Initialize highlight.js
    hljs.highlightAll();
    
    // Start online users tracker - ADD THIS
    startOnlineUsersTracker();
    setupPageVisibility();
     themeManager = new ThemeManager();
    // Initialize Firebase auth and load data
    initAuth();
    initEventListeners();
    
    // Load initial scripts and initialize sample data if needed
    loadScripts();
    initializeSampleData();
}

document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key === 'T') {
        e.preventDefault();
        themeManager.cycleTheme();
        showNotification(`Theme changed to ${themeManager.getCurrentTheme()}`);
    }
});




        function initEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    
                    // Hide all sections
                    document.querySelectorAll('.section').forEach(s => {
                        s.style.display = 'none';
                    });
                    
                    // Show selected section
                    document.getElementById(`${section}-section`).style.display = 'block';
                    
                      // Load section-specific content
        if (section === 'trending') {
            loadTrendingScripts();
        }  else if (section === 'profile') {
            loadFavoriteScripts();
        }

                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(l => {
                        l.style.color = '';
                    });
                    this.style.color = 'var(--primary)';
                    
                    // Load favorites if on profile section
                    if (section === 'profile') {
                        loadFavoriteScripts();
                    }
                });
            });
            


            // Profile tabs
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.profile-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.profile-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Load favorites if needed
                    if (tabId === 'favorites') {
                        loadFavoriteScripts();
                    }
                });
            });
            
            // Footer links
            document.querySelectorAll('.footer-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.dataset.page;
                    showNotification(`${page.charAt(0).toUpperCase() + page.slice(1)} page coming soon!`);
                });
            });
            
            // File upload handlers
            document.getElementById('scriptImage').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const fileName = document.getElementById('fileName');
    const previewContainer = document.getElementById('imagePreviewContainer');
    const preview = document.getElementById('imagePreview');
    
    if (file) {
        fileName.textContent = file.name;
        
        // Validate file
        if (!validateImageFile(file)) {
            this.value = '';
            fileName.textContent = 'No file chosen';
            previewContainer.style.display = 'none';
            return;
        }
        
        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        fileName.textContent = 'No file chosen';
        previewContainer.style.display = 'none';
    }
});
            

// Mobile menu functionality
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const mobileCloseBtn = document.getElementById('mobileCloseBtn');
const mobileNav = document.getElementById('mobileNav');
const mobileLinks = document.querySelectorAll('.mobile-link');

// Open mobile menu
mobileMenuBtn.addEventListener('click', function() {
    mobileNav.style.display = 'block';
    setTimeout(() => {
        mobileNav.classList.add('active');
    }, 10);
});

// Close mobile menu
mobileCloseBtn.addEventListener('click', closeMobileMenu);

// Close when clicking on links
mobileLinks.forEach(link => {
    link.addEventListener('click', closeMobileMenu);
});

// Close when clicking outside content
mobileNav.addEventListener('click', function(e) {
    if (e.target === mobileNav) {
        closeMobileMenu();
    }
});

function closeMobileMenu() {
    mobileNav.classList.remove('active');
    setTimeout(() => {
        mobileNav.style.display = 'none';
    }, 300);
}

// Mobile auth buttons
document.getElementById('mobileLoginBtn').addEventListener('click', function() {
    closeMobileMenu();
    document.getElementById('loginModal').style.display = 'flex';
});

document.getElementById('mobileSignupBtn').addEventListener('click', function() {
    closeMobileMenu();
    document.getElementById('signupModal').style.display = 'flex';
});

document.getElementById('mobileLogoutBtn').addEventListener('click', function() {
    closeMobileMenu();
    // Use your existing logout function
    document.getElementById('logoutBtn').click();
});


/////////////////////////////////////////////////////////////


document.getElementById('editScriptImage').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const fileName = document.getElementById('editFileName');
    const previewContainer = document.getElementById('editNewImagePreviewContainer');
    const preview = document.getElementById('editNewImagePreview');
    
    if (file) {
        fileName.textContent = file.name;
        
        // Validate file
        if (!validateImageFile(file)) {
            this.value = '';
            fileName.textContent = 'No file chosen';
            previewContainer.style.display = 'none';
            return;
        }
        
        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        fileName.textContent = 'No file chosen';
        previewContainer.style.display = 'none';
    }
});
            


            // Profile picture upload
            document.getElementById('profilePicture').addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    document.getElementById('profilePictureName').textContent = file.name;
                    
                    // Preview image
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('profilePicturePreview').src = e.target.result;
                        document.getElementById('profilePicturePreview').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
              // Save Profile Button - NEW EVENT LISTENER
    document.getElementById('saveProfileBtn').addEventListener('click', function() {
        saveProfileInfo();
    });

            // Game ID input handlers
            document.getElementById('gameId').addEventListener('input', async function() {
                const gameId = this.value;
                const gameNameDisplay = document.getElementById('gameNameDisplay');
                const gameIdLoading = document.getElementById('gameIdLoading');
                
                if (gameId.length > 3) {
                    gameIdLoading.style.display = 'block';
                    gameNameDisplay.textContent = '';
                    
                    const gameName = await getRobloxGameName(gameId);
                    gameIdLoading.style.display = 'none';
                    gameNameDisplay.textContent = gameName;
                    gameNameDisplay.style.color = gameName !== "Roblox Game" ? "var(--success)" : "var(--primary)";
                } else {
                    gameNameDisplay.textContent = '';
                    gameIdLoading.style.display = 'none';
                }
            });

            document.getElementById('editGameId').addEventListener('input', async function() {
                const gameId = this.value;
                const gameNameDisplay = document.getElementById('editGameNameDisplay');
                const gameIdLoading = document.getElementById('editGameIdLoading');
                
                if (gameId.length > 3) {
                    gameIdLoading.style.display = 'block';
                    gameNameDisplay.textContent = '';
                    
                    const gameName = await getRobloxGameName(gameId);
                    gameIdLoading.style.display = 'none';
                    gameNameDisplay.textContent = gameName;
                    gameNameDisplay.style.color = gameName !== "Roblox Game" ? "var(--success)" : "var(--primary)";
                } else {
                    gameNameDisplay.textContent = '';
                    gameIdLoading.style.display = 'none';
                }
            });

            // Filter buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    filterScripts(this.dataset.filter);
                });
            });
            
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                filterScripts(document.querySelector('.filter-btn.active').dataset.filter, this.value);
            });
            
            // Modal functionality
            const modals = document.querySelectorAll('.modal');
            const closeButtons = document.querySelectorAll('.close-modal');
            
closeButtons.forEach(button => {
    button.addEventListener('click', function() {
        modals.forEach(modal => {
            modal.style.display = 'none';
            // Reset edit modal specifically
            if (modal.id === 'editModal') {
                document.getElementById('editForm').reset();
                document.getElementById('editImagePreviewContainer').style.display = 'none';
                document.getElementById('editNewImagePreviewContainer').style.display = 'none';
                document.getElementById('editGameNameDisplay').textContent = '';
                document.getElementById('editFileName').textContent = '';
                currentEditingScript = null;
            }
        });
    });
});
            
          window.addEventListener('click', function(event) {
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
            if (modal.id === 'editModal') {
                resetEditModal();
            }
        }
    });
});
            

            // Auth modal triggers
            document.getElementById('loginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'flex';
            });
            
            document.getElementById('signupBtn').addEventListener('click', function() {
                document.getElementById('signupModal').style.display = 'flex';
            });
            
            document.getElementById('showSignup').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('signupModal').style.display = 'flex';
            });
            
            document.getElementById('showLogin').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('signupModal').style.display = 'none';
                document.getElementById('loginModal').style.display = 'flex';
            });
            
   // Password reset functionality
document.getElementById('forgotPassword').addEventListener('click', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    
    if (!email) {
        showNotification('Please enter your email address first', true);
        return;
    }
    
    if (!validateEmail(email)) {
        showNotification('Please enter a valid email address', true);
        return;
    }
    
    try {
        await sendPasswordResetEmail(auth, email);
        showNotification('Password reset email sent! Check your inbox.');
    } catch (error) {
        console.error('Password reset error:', error);
        
        let errorMessage = 'Error sending reset email. Please try again.';
        switch (error.code) {
            case 'auth/user-not-found':
                errorMessage = 'No account found with this email address.';
                break;
            case 'auth/invalid-email':
                errorMessage = 'Invalid email address.';
                break;
            case 'auth/too-many-requests':
                errorMessage = 'Too many attempts. Please try again later.';
                break;
        }
        
        showNotification(errorMessage, true);
    }
});

// Add this to your profile actions
async function resendVerificationEmail() {
    if (!currentUser) return;
    
    try {
        await sendEmailVerification(auth.currentUser);
        showNotification('Verification email sent! Please check your inbox.');
    } catch (error) {
        console.error('Error sending verification email:', error);
        showNotification('Error sending verification email. Please try again.', true);
    }
}

// Add this button to your profile section
document.getElementById('resendVerificationBtn').addEventListener('click', resendVerificationEmail);





function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

function validatePassword(password) {
    return password.length >= 6;
}

            // Upload script modal
            document.getElementById('openUploadModal').addEventListener('click', function() {
                if (currentUser) {
                    document.getElementById('uploadModal').style.display = 'flex';
                } else {
                    showNotification('Please log in to upload scripts', true);
                    document.getElementById('loginModal').style.display = 'flex';
                }
            });
            
            document.getElementById('uploadScriptBtn').addEventListener('click', function() {
                if (currentUser) {
                    document.getElementById('uploadModal').style.display = 'flex';
                } else {
                    showNotification('Please log in to upload scripts', true);
                    document.getElementById('loginModal').style.display = 'flex';
                }
            });
            
            // Profile picture edit
           document.getElementById('changeProfilePictureBtn').addEventListener('click', function() {
    document.getElementById('profilePictureModal').style.display = 'flex';
});
            

            // Save profile picture
// Save profile picture
document.getElementById('saveProfilePicture').addEventListener('click', async function() {
    const file = document.getElementById('profilePicture').files[0];
    if (!file) {
        showNotification('Please select a profile picture', true);
        return;
    }
    
    try {
        // Validate image file before upload
        if (!validateImageFile(file)) {
            return;
        }
        
        // Show loading state
        const saveBtn = document.getElementById('saveProfilePicture');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        saveBtn.disabled = true;
        
        // Convert image to Base64
        const imageBase64 = await fileToBase64(file);
        
        // Save to user document with Base64 data
        await setDoc(doc(db, 'users', currentUser.uid), {
            profilePicture: imageBase64,
            username: currentUser.username,
            email: currentUser.email
        }, { merge: true });
        
        document.getElementById('profilePictureModal').style.display = 'none';
        
        // Reset button state
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
        
        showNotification('Profile picture updated successfully!');
        
        // Update UI
        await updateUIForUser();
    } catch (error) {
        console.error('Error uploading profile picture:', error);
        
        // Reset button state on error
        const saveBtn = document.getElementById('saveProfilePicture');
        saveBtn.innerHTML = 'Save Profile Picture';
        saveBtn.disabled = false;
        
        showNotification('Error uploading profile picture: ' + error.message, true);
    }
});
            
            // Form submissions
         // Form submissions
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        document.getElementById('loginModal').style.display = 'none';
        showNotification('Login successful!');
        
        // Reset form
        document.getElementById('loginForm').reset();
    } catch (error) {
        console.error('Login error:', error);
        
        // Specific error messages
        let errorMessage = 'Login failed. Please try again.';
        switch (error.code) {
            case 'auth/invalid-email':
                errorMessage = 'Invalid email address.';
                break;
            case 'auth/user-disabled':
                errorMessage = 'This account has been disabled.';
                break;
            case 'auth/user-not-found':
                errorMessage = 'No account found with this email.';
                break;
            case 'auth/wrong-password':
                errorMessage = 'Incorrect password.';
                break;
            case 'auth/invalid-login-credentials':
                errorMessage = 'Invalid login credentials. Please check your email and password.';
                break;
            case 'auth/too-many-requests':
                errorMessage = 'Too many failed attempts. Please try again later.';
                break;
        }
        
        showNotification(errorMessage, true);
    }
});
            
// Enhanced signup function with email verification
document.getElementById('signupForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('signupUsername').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    
    // Basic validation
    if (password.length < 6) {
        showNotification('Password must be at least 6 characters long', true);
        return;
    }
    
    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Update profile with username
        await updateProfile(user, {
            displayName: username
        });
        
        // Send email verification
        await sendEmailVerification(user);
        
        
        // Create user document in Firestore
await setDoc(doc(db, 'users', user.uid), {
    username: username,
    email: email,
    emailVerified: false,
    joinDate: serverTimestamp(), // This ensures join date is recorded
    favorites: [],
    profilePicture: imageBase64,
});
        
        document.getElementById('signupModal').style.display = 'none';
        showNotification('Account created! Please check your email for verification.');
        
        // Reset form
        document.getElementById('signupForm').reset();
    } catch (error) {
        console.error('Signup error:', error);
        
        let errorMessage = 'Signup failed. Please try again.';
        switch (error.code) {
            case 'auth/email-already-in-use':
                errorMessage = 'This email is already registered.';
                break;
            case 'auth/invalid-email':
                errorMessage = 'Invalid email address.';
                break;
            case 'auth/operation-not-allowed':
                errorMessage = 'Email/password accounts are not enabled.';
                break;
            case 'auth/weak-password':
                errorMessage = 'Password is too weak.';
                break;
        }
        
        showNotification(errorMessage, true);
    }
});
            


document.getElementById('uploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!currentUser) {
        showNotification('Please log in to upload scripts', true);
        return;
    }

    const title = document.getElementById('scriptTitle').value;
    const gameId = document.getElementById('gameId').value;
    const code = document.getElementById('scriptCode').value;
    const isPatched = document.getElementById('isPatched').checked;
    const requiresKey = document.getElementById('keySystemToggle').checked;
    const imageFile = document.getElementById('scriptImage').files[0];

    // Validate required fields
    if (!title.trim()) {
        showNotification('Please enter a script title', true);
        return;
    }

    if (!gameId.trim()) {
        showNotification('Please enter a Roblox Game ID', true);
        return;
    }

    if (!code.trim()) {
        showNotification('Please enter script code', true);
        return;
    }

    try {
        const gameName = await getRobloxGameName(gameId);
        let imageBase64 = null;

        // Convert image to Base64 if provided
        if (imageFile) {
            try {
                // Validate image file
                if (!validateImageFile(imageFile)) {
                    return;
                }
                
                // Convert to Base64
                imageBase64 = await fileToBase64(imageFile);
                console.log('Image converted to Base64, length:', imageBase64.length);
                
            } catch (error) {
                showNotification('Error processing image: ' + error.message, true);
                return;
            }
        }

        // Create script data object
const scriptData = {
    title: title.trim(),
    game: gameName,
    gameId: gameId.trim(),
    code: code.trim(),
    patched: isPatched,
    requiresKey: requiresKey,
    Views: 0,  // Changed from downloads to Views
    copyCount: 0,
    author: currentUser.uid,
    authorName: currentUser.username,
    createdAt: serverTimestamp(),
    isUserCreated: true
};

        // Add Base64 image if available
        if (imageBase64) {
            scriptData.imageBase64 = imageBase64;
        }

        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        submitBtn.disabled = true;

        // Upload script document to Firestore
        await addDoc(collection(db, 'scripts'), scriptData);

        document.getElementById('uploadModal').style.display = 'none';
        document.getElementById('uploadForm').reset();
        document.getElementById('gameNameDisplay').textContent = '';
        document.getElementById('fileName').textContent = 'No file chosen';
        document.getElementById('imagePreviewContainer').style.display = 'none';
        
        // Reset button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        loadScripts();
        loadUserStats();
        showNotification('Script uploaded successfully!');
        
    } catch (error) {
        console.error('Upload error:', error);
        
        // Reset button state on error
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = 'Upload Script';
        submitBtn.disabled = false;
        
        showNotification('Upload failed: ' + error.message, true);
    }
});

// Convert file to Base64 string
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file); // This converts to Base64 data URL
    });
}


// File validation function
function validateImageFile(file) {
    const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
    const maxSize = 1 * 1024 * 1024; // 1MB
    
    if (!file) {
        showNotification('Please select an image file', true);
        return false;
    }
    
    if (!validTypes.includes(file.type)) {
        showNotification('Please select a JPEG or PNG image only', true);
        return false;
    }
    
    if (file.size > maxSize) {
        showNotification('Image size must be less than 1MB', true);
        return false;
    }
    
    // Additional validation: check file extension
    const fileName = file.name.toLowerCase();
    const validExtensions = ['.jpg', '.jpeg', '.png'];
    const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));
    
    if (!hasValidExtension) {
        showNotification('File must be a JPG, JPEG, or PNG image', true);
        return false;
    }
    
    return true;
}

function resetEditModal() {
    document.getElementById('editForm').reset();
    document.getElementById('editGameNameDisplay').textContent = '';
    document.getElementById('editFileName').textContent = 'No file chosen';
    document.getElementById('editImagePreviewContainer').style.display = 'none';
    document.getElementById('editNewImagePreviewContainer').style.display = 'none';
    currentEditingScript = null;
    
    // Reset file input
    document.getElementById('editScriptImage').value = '';
}
            
document.getElementById('editForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!currentUser) {
        showNotification('Please log in to edit scripts', true);
        return;
    }
    
    const scriptId = document.getElementById('editScriptId').value;
    const title = document.getElementById('editScriptTitle').value;
    const gameId = document.getElementById('editGameId').value;
    const code = document.getElementById('editScriptCode').value;
    const isPatched = document.getElementById('editIsPatched').checked;
    const requiresKey = document.getElementById('editKeySystemToggle').checked;
    const imageFile = document.getElementById('editScriptImage').files[0];
    
    // Validate required fields
    if (!title.trim()) {
        showNotification('Please enter a script title', true);
        return;
    }

    if (!gameId.trim()) {
        showNotification('Please enter a Roblox Game ID', true);
        return;
    }

    if (!code.trim()) {
        showNotification('Please enter script code', true);
        return;
    }
    
    try {
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        submitBtn.disabled = true;

        const gameName = await getRobloxGameName(gameId);
        let imageBase64 = currentEditingScript.imageBase64 || null;
        
        // Convert new image to Base64 if provided
        if (imageFile) {
            try {
                // Validate image file
                if (!validateImageFile(imageFile)) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }
                
                // Convert to Base64
                imageBase64 = await fileToBase64(imageFile);
                console.log('New image converted to Base64');
                
            } catch (error) {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                showNotification('Error processing image: ' + error.message, true);
                return;
            }
        }
        
        // Create update data object
        const updateData = {
            title: title.trim(),
            game: gameName,
            gameId: gameId.trim(),
            code: code.trim(),
            patched: isPatched,
            requiresKey: requiresKey,
            updatedAt: serverTimestamp()
        };
        
        // Handle image data
        if (imageBase64 !== null) {
            updateData.imageBase64 = imageBase64;
        } else {
            // If no image should be kept, remove the field
            updateData.imageBase64 = null;
        }
        
        // Update the script in Firestore
        await updateDoc(doc(db, 'scripts', scriptId), updateData);
        
        // Close modal and reset
        document.getElementById('editModal').style.display = 'none';
        resetEditModal();
        
        // Reset button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        // Refresh the UI
        loadScripts();
        loadUserStats();
        showNotification('Script updated successfully!');
        
    } catch (error) {
        console.error('Edit error:', error);
        
        // Reset button state on error
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = 'Update Script';
        submitBtn.disabled = false;
        
        showNotification('Edit failed: ' + error.message, true);
    }
});


            
           // Logout functionality
document.getElementById('logoutBtn').addEventListener('click', async function() {
    try {
        // Clear user from online users
        if (currentUser) {
            const onlineUsersRef = collection(db, 'onlineUsers');
            const userRef = doc(onlineUsersRef, currentUser.uid);
            await deleteDoc(userRef);
        }
        
        // Clear guest ID from localStorage
        localStorage.removeItem('guestId');
        
        // Sign out from Firebase
        await signOut(auth);
        
        showNotification('Logged out successfully');
        
        // Force update online users count
        setTimeout(() => {
            updateOnlineUsers();
        }, 1000);
        
    } catch (error) {
        console.error('Logout error:', error);
        // Still try to sign out even if online status update fails
        await signOut(auth);
        showNotification('Logged out successfully');
    }
});

        }

        function filterScripts(type, searchTerm = '') {
            const scriptCards = document.querySelectorAll('.script-card');
            const searchLower = searchTerm.toLowerCase();
            
            scriptCards.forEach(card => {
                const title = card.querySelector('.script-title').textContent.toLowerCase();
                const game = card.querySelector('.script-game').textContent.toLowerCase();
                
                const typeMatch = type === 'all' || true;
                const searchMatch = !searchTerm || title.includes(searchLower) || 
                    game.includes(searchLower);
                
                card.style.display = typeMatch && searchMatch ? 'block' : 'none';
            });
        }


       // Make functions available globally
  window.viewScriptDetails = viewScriptDetails;
    window.editScript = editScript;
    window.deleteScript = deleteScript;
    window.copyScript = copyScript;
    window.copyScriptFromDetails = copyScriptFromDetails;
    window.closeScriptDetails = closeScriptDetails;
    window.initializeApp = initApplication;
    window.themeManager = themeManager;

</script>
</body>
</html>



